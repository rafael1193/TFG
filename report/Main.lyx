#LyX 2.1 created this file. For more info see http://www.lyx.org/
\lyxformat 474
\begin_document
\begin_header
\textclass scrbook
\begin_preamble
\usepackage[style=numeric,backend=biber]{biblatex}

\addbibresource{/home/rafael/Documentos/4o Curso/8o Semestre/Trabajo Fin de Grado/report/bibliography.bib}
\renewcommand\listingname{Código}

\renewcaptionname{spanish}{\listtablename}{Índice de tablas}
\renewcaptionname{spanish}{\tablename}{Tabla}
\end_preamble
\use_default_options true
\maintain_unincluded_children false
\begin_local_layout
Format 49
Float
    Type                  listing
    GuiName               Code Listing
    Placement             tbp
    Extension             lol
    NumberWithin          chapter
    Style                 ruled
    ListName              "Índice de código"
    IsPredefined false
    UsesFloatPkg true
End
\end_local_layout
\language spanish
\language_package babel
\inputencoding utf8
\fontencoding global
\font_roman libertine
\font_sans biolinum
\font_typewriter libertine-mono
\font_math auto
\font_default_family default
\use_non_tex_fonts false
\font_sc false
\font_osf false
\font_sf_scale 100
\font_tt_scale 100
\graphics default
\default_output_format default
\output_sync 0
\bibtex_command biber
\index_command default
\float_placement h
\paperfontsize 12
\spacing onehalf
\use_hyperref true
\pdf_bookmarks true
\pdf_bookmarksnumbered true
\pdf_bookmarksopen true
\pdf_bookmarksopenlevel 1
\pdf_breaklinks false
\pdf_pdfborder true
\pdf_colorlinks false
\pdf_backref false
\pdf_pdfusetitle true
\papersize default
\use_geometry true
\use_package amsmath 1
\use_package amssymb 1
\use_package cancel 1
\use_package esint 1
\use_package mathdots 1
\use_package mathtools 1
\use_package mhchem 1
\use_package stackrel 1
\use_package stmaryrd 1
\use_package undertilde 1
\cite_engine basic
\cite_engine_type default
\biblio_style plain
\use_bibtopic false
\use_indices false
\paperorientation portrait
\suppress_date false
\justification true
\use_refstyle 1
\index Index
\shortcut idx
\color #008000
\end_index
\leftmargin 2.5cm
\topmargin 2.5cm
\rightmargin 2.5cm
\bottommargin 2.5cm
\secnumdepth 3
\tocdepth 3
\paragraph_separation indent
\paragraph_indentation default
\quotes_language french
\papercolumns 1
\papersides 2
\paperpagestyle headings
\tracking_changes false
\output_changes false
\html_math_output 0
\html_css_as_file 0
\html_be_strict false
\end_header

\begin_body

\begin_layout Title
Diseño de un pulsómetro por infrarrojos
\end_layout

\begin_layout Author
Rafael Bailón Ruiz
\end_layout

\begin_layout Date
Julio 2015
\end_layout

\begin_layout Dedication
Quiero agradecer a mis tutores de este Trabajo Fin de Grado la ayuda en
 su realización.
 Asimismo, expreso mi gratitud a los profesores del Grado en Ingeniería
 Electrónica Industrial por el conocimiento que me han transmitido.
\begin_inset Newline linebreak
\end_inset


\begin_inset Newline newline
\end_inset

A mis padres, mi hermano y mis amigos, que me apoyan en la aventura de ser
 ingeniero.
\end_layout

\begin_layout Standard
\begin_inset External
	template PDFPages
	filename anexos.pdf
	extra LaTeX "pages=-"

\end_inset


\end_layout

\begin_layout Standard
\begin_inset CommandInset toc
LatexCommand tableofcontents

\end_inset


\end_layout

\begin_layout Standard
\begin_inset FloatList figure

\end_inset


\end_layout

\begin_layout Standard
\begin_inset FloatList table

\end_inset


\end_layout

\begin_layout Standard
\begin_inset FloatList listing

\end_inset


\end_layout

\begin_layout Standard
\begin_inset CommandInset nomencl_print
LatexCommand printnomenclature
set_width "auto"

\end_inset


\end_layout

\begin_layout Chapter
Introducción, motivación y objetivos
\begin_inset CommandInset label
LatexCommand label
name "chap:Introducción,-motivación-y"

\end_inset


\end_layout

\begin_layout Section
Introducción
\begin_inset CommandInset label
LatexCommand label
name "sec:Introducción"

\end_inset


\end_layout

\begin_layout Standard
Los signos vitales son los parámetros que permiten valorar el estado de
 las funciones corporales básicas de los seres humanos.
 Dichos signos son cuatro:
\end_layout

\begin_layout Itemize
Temperatura corporal
\end_layout

\begin_layout Itemize
Frecuencia cardíaca
\end_layout

\begin_layout Itemize
Tensión arterial
\end_layout

\begin_layout Itemize
Frecuencia respiratoria
\end_layout

\begin_layout Standard
La frecuencia cardíaca es la tasa de latidos del corazón, e indica el nivel
 de actividad de este.
 Los latidos provocan el bombeo de la sangre a través de los vasos sanguíneos
 que recorren todo el cuerpo humano.
 Como consecuencia del paso de la sangre, se produce una expansión periódica
 de los vasos llamada pulso.
\end_layout

\begin_layout Standard
La adquisición de la tasa de latidos es un procedimiento básico en el diagnóstic
o de un paciente y la pulsimetría es uno de los métodos utilizadas para
 ello.
 Esta técnica se basa en el procesamiento de un Fotopletismograma (PPG
\begin_inset CommandInset nomenclature
LatexCommand nomenclature
symbol "PPG"
description "Photoplethysmogram, fotopletismograma"

\end_inset

), una representación de la variación volumétrica de las arterias obtenida
 con un sensor óptico.
 
\end_layout

\begin_layout Standard
La pulsimétria es un método basado en fotopletismograma para monitorizar
 el pulso cardíaco.
 Usa las variaciones pulsátiles en la absorbancia óptica de los tejidos
 y la sangre bajo luz infrarroja.
\end_layout

\begin_layout Standard
Este Trabajo Fin de Grado presenta el diseño de un dispositivo pulsimétrico
 con comunicación con 
\emph on
smartphone
\emph default
 para realizar la monitorización remota de la frecuencia cardíaca de un
 paciente.
\end_layout

\begin_layout Section
Motivación
\begin_inset CommandInset label
LatexCommand label
name "sec:Motivación"

\end_inset


\end_layout

\begin_layout Standard
La población en los países desarrollados es cada vez más anciana y cada
 vez son necesarios más medios su cuidado.
 Gracias a los avances sanitarios, muchas enfermedades ya no suponen el
 fallecimiento inmediato sino que se han convertido en crónicas.
 Los pacientes pueden mantener una gran calidad de vida si están tratados
 adecuadamente y se mantiene una revisión periódica de su estado de salud.
 No obstante los recursos son limitados y con los métodos tradicionales
 de trato con los pacientes son insuficientes para cubrir sus expectativas.
 El 
\emph on
telecuidado
\emph default
 se pantea como un posible solución al incremento de necesidades sanitarias
 de los ciudadanos
\begin_inset CommandInset citation
LatexCommand cite
key "gonzalez-landaeta_heart_2008"

\end_inset

.
\end_layout

\begin_layout Standard
Otro factor que hace necesario el telecuidado es el incremento en el numero
 de incidentes inesperadas, infarto y muerte súbita, que causan el fallecimiento
 en el hogar o en zonas alejadas de las instalaciones médicas
\begin_inset CommandInset citation
LatexCommand cite
key "ramlee_low_2014"

\end_inset

.
\end_layout

\begin_layout Standard
Los sistemas de 
\emph on
cuidado en casa
\emph default
 actuales requieren conectar electrodos u otros sensores al cuerpo, lo que
 puede resultar incómodo al paciente, que ve su libertad de movimiento limitada
\begin_inset CommandInset citation
LatexCommand cite
key "ramlee_low_2014"

\end_inset

.
 Gracias a las comunicaciones inalámbricas, ZigBee, Bluetooth, WiFi, y a
 internet la 
\emph on
telemedicina
\emph default
 es ahora posible.
\end_layout

\begin_layout Standard
Estas nuevas situaciones hacen necesario idear sistemas revolucionarios
 que permitan conectar de manera más fácil y eficiente a los pacientes con
 los profesionales sanitarios.
 Los 
\emph on
smartphones
\emph default
, teléfonos inteligentes, y 
\emph on
wearable devices
\emph default
, dispositivos vestibles, tienen en la actualidad la potencia y la conectividad
 suficiente para la piedra angular de la medicina del futuro
\begin_inset CommandInset citation
LatexCommand cite
key "lamonaca_health_2015"

\end_inset

.
\end_layout

\begin_layout Section
Objetivos
\begin_inset CommandInset label
LatexCommand label
name "sec:Objetivos"

\end_inset


\end_layout

\begin_layout Standard
Los objetivos de este Trabajo Fin de Grado son:
\end_layout

\begin_layout Itemize
Estudio bibliográfico de las señales cardíacas y de dispositivos existentes
 para su medida.
\end_layout

\begin_layout Itemize
Diseño y fabricación de un pulsómetro con sensor infrarrojo.
\end_layout

\begin_deeper
\begin_layout Itemize
Obtención del fotopletismograma
\end_layout

\begin_layout Itemize
Procesado de la señal
\end_layout

\begin_layout Itemize
Adquisición mediante un microcontrolador
\end_layout

\begin_layout Itemize
Comunicación inalámbrica con un sistema monitorización
\end_layout

\end_deeper
\begin_layout Itemize
Diseño e implementación de una aplicación móvil para la monitorización remota
 el pulso cardíaco de un paciente.
\end_layout

\begin_layout Chapter
Estado del Arte
\end_layout

\begin_layout Section
Fundamento Teórico
\end_layout

\begin_layout Standard
El corazón es el órgano principal del aparato circulatorio.
 Es un músculo hueco situado en la cavidad torácica que funciona como una
 bomba impulsando la sangre a todo el cuerpo
\begin_inset CommandInset citation
LatexCommand cite
key "_corazon_2015"

\end_inset

.
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename ../img/corazon.svg
	lyxscale 10
	width 50text%

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:Diagrama-del-corazón"

\end_inset

Diagrama del corazón
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
Este músculo está dividido en cuatro cámaras, Figura 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Diagrama-del-corazón"

\end_inset

: dos aurículas, derecha e izquierda y dos ventrículos, derecho e izquierdo.
\end_layout

\begin_layout Subsection
Ciclo cardíaco
\end_layout

\begin_layout Standard
El ciclo cardíaco es la secuencia de eventos eléctricos, mecánicos, sonoros
 y de presión, relacionados con el flujo de sangre a través de las cavidades
 cardiacas, la contracción y relajación de cada una de ellas (aurículas
 y ventrículos), el cierre y apertura de las válvulas y la producción de
 ruidos a ellas asociados
\begin_inset CommandInset citation
LatexCommand cite
key "_ciclo_2015"

\end_inset

.
 Latido es el nombre que recibe cada repetición del ciclo cardíaco.
\end_layout

\begin_layout Standard
En cada latido se distinguen cinco fases:
\end_layout

\begin_layout Enumerate
Sístole auricular
\end_layout

\begin_layout Enumerate
Contracción ventricular isovolumétrica
\end_layout

\begin_layout Enumerate
Eyección
\end_layout

\begin_layout Enumerate
Relajación ventricular isovolumétrica
\end_layout

\begin_layout Enumerate
Llenado auricular pasivo
\end_layout

\begin_layout Standard
Las tres primeras fases son llamadas la sístole (contracción) y las dos
 últimas, diástole (relajación).
 La duración de la sístole es un tercio del ciclo cardíaco y la de la diástole,
 dos terceras partes del periodo.
\end_layout

\begin_layout Description
Sístole
\begin_inset space \space{}
\end_inset

auricular Las aurículas se contraen y toda la sangre que contienen pasan
 a los ventrículos (Figura 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Sístole-ventricular"

\end_inset

)
\end_layout

\begin_layout Description
Contracción
\begin_inset space \space{}
\end_inset

ventricular
\begin_inset space \space{}
\end_inset

isovolumétrica Aumenta la presión en el interior de los ventrículos debido
 a su contracción.
 El cierre de las válvulas auriculoventriculares impide el retorno de la
 sangre.
\end_layout

\begin_layout Description
Eyección La válvula del tronco pulmonar y la válvula de la aorta se abren.
 La sangre del ventrículo derecho se impulsa a través de la arteria pulmonar
 hacia los pulmones para oxigenarse y la sangre del ventrículo izquierdo
 viaja hacia el resto de cuerpo a través de la arteria aorta.
 El volumen eyectado es de aproximadamente 70
\begin_inset space ~
\end_inset

mL.
\end_layout

\begin_layout Description
Relajación
\begin_inset space \space{}
\end_inset

ventricular
\begin_inset space \space{}
\end_inset

isovolumétrica Disminuye la presión en los ventrículos provocando el cierre
 de las válvulas sigmoideas (arteriales) y la apertura de las válvulas auriculov
entrales.
\end_layout

\begin_layout Description
Llenado
\begin_inset space \space{}
\end_inset

ventricular
\begin_inset space \space{}
\end_inset

pasivo Durante las otras fases las aurículas han estado llenandose de sangre.
 El aumento del la presión en estas cavidades respecto a la de los ventrículos
 provoca que la sangre fluya hacia ellos, comenzando el siguiente ciclo
 (Figura 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Diástole-ventricular"

\end_inset

)
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout
\align center
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename ../img/Heart_systole.svg
	lyxscale 10
	width 25text%

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:Sístole-ventricular"

\end_inset

Sístole ventricular
\begin_inset CommandInset citation
LatexCommand cite
key "mtcv_human_2008"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename /home/rafael/Documentos/4o Curso/8o Semestre/Trabajo Fin de Grado/img/Heart_diasystole.svg
	lyxscale 10
	width 25text%

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:Diástole-ventricular"

\end_inset

Diástole ventricular
\begin_inset CommandInset citation
LatexCommand cite
key "sjef_human_2008"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
Movimientos cardíacos
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
La frecuencia cardíaca en reposo evoluciona con la edad y el estado físico
 del sujeto, pero suele estar entre 60 y 100
\begin_inset space ~
\end_inset

PPM.
\end_layout

\begin_layout Subsection
Las señales cardíacas
\end_layout

\begin_layout Subsubsection
Electrocardiograma
\end_layout

\begin_layout Standard
El movimiento del músculo cardíaco tiene su origen en la actividad eléctrica
 del corazón.
 El electrocardiograma es la representación gráfica del voltaje durante
 el ciclo cardíaco.
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename /home/rafael/Documentos/4o Curso/8o Semestre/Trabajo Fin de Grado/img/ECG_Complex_es.svg
	lyxscale 25
	width 50text%

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:Electrocardiograma"

\end_inset

Electrocardiograma
\begin_inset CommandInset citation
LatexCommand cite
key "helvete_dibujo_2014"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
Como se muestra en la Figura 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Electrocardiograma"

\end_inset

 el electrocardiograma está compuesto por ondas y segmentos sobre la línea
 base
\begin_inset CommandInset citation
LatexCommand cite
key "garcia-porrero_anatomia_2013"

\end_inset

.
 
\end_layout

\begin_layout Standard
La onda P es la señal eléctrica que corresponde a la despolarización auricular.
 Su amplitud es inferior a 25
\begin_inset space ~
\end_inset

mV y si duración está entre 0,07 y 0,11 segundos.
 Tras esta onda, tiene origen el segmento PR.
 Este segmento representa el tiempo que tarda el impulso eléctrico en viajar
 desde la aurícula al ventrículo.
 La espera es importante porque permite que la sangre se desplace hacia
 la aurícula desde el ventrículo.
\end_layout

\begin_layout Standard
El complejo QRS se produce por la superposición de las señales eléctricas
 durante la contracción ventricular.
 Es uno de los segmentos mas característicos para la detección de la frecuencia
 cardíaca y su amplitud es mayor porque el área muscular del ventrículo
 es mucho mas poderosa, para poder bombear la sangre.
\end_layout

\begin_layout Standard
El segmento ST refleja la despolarización auricular, es decir, la diástole
 y la onda T la repolarización previa a la apertura de las válvulas para
 el nuevo ciclo.
\end_layout

\begin_layout Subsubsection
Fotopletismograma
\end_layout

\begin_layout Standard
El paso de la sangre a través de las arterias da lugar a un incremento volumeric
o en las mismas ligado a las variaciones de presión en el corazón.
 La medida de este incremento da lugar al fotopletismograma.
\end_layout

\begin_layout Standard
La fotopletismografía es una manifestación de la actividad cardíaca y se
 puede realizar en zonas del cuerpo donde el aparato circulatorio se expone
 cerca de la piel, como dedos, muñeca y orejas.
 
\end_layout

\begin_layout Standard
El diagrama de Wigger, Figura 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Diagrama-de-Wiggers"

\end_inset

, representa bajo los mismos ejes la evolución de varias magnitudes.
 Se observa como tras el complejo QRS se produce la contracción ventricular,
 aumenta la presión en la arteria aorta y el volumen del ventrículo disminuye
 al expulsarse la sangre.
 Tras la onda T de repolarización, se cierra la válvula aorta provocando
 un ligero incremento de la presión.
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename /home/rafael/Documentos/4o Curso/8o Semestre/Trabajo Fin de Grado/img/Wiggers_Diagram.svg
	lyxscale 20
	width 75text%

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:Diagrama-de-Wiggers"

\end_inset

Diagrama de Wiggers
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
Este efecto sobre la arteria es el que se puede percibir en todo el sistema
 circulatorio mediante la fotopletismografía.
 En ocasiones, incluso la pequeña varaición producida por la onda T pequeña
 puede identificarse como un pico secundario.
\end_layout

\begin_layout Standard
En la Figura 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Representación-de-ECG,"

\end_inset

 se observa la representación de ECG, traza inferior, tomada sobre el pie
 de un sujeto
\begin_inset CommandInset citation
LatexCommand cite
key "gonzalez-landaeta_heart_2008"

\end_inset

.
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename /home/rafael/Documentos/4o Curso/8o Semestre/Trabajo Fin de Grado/img/ECG-y-PPG-González-Landaeta.svg
	lyxscale 10
	width 75text%

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:Representación-de-ECG,"

\end_inset

Representación de ECG, traza superior, y PPG, traza inferior
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Medida de las pulsaciones
\end_layout

\begin_layout Standard
La fotopletismografía es un método óptico con el que se registra la variación
 de la absorbancia de tejidos, órganos y fluidos al ser iluminados.
 El rango de frecuencias habitual oscila entre el infrarrojo y el rojo.
\end_layout

\begin_layout Standard
Los sensores para fotopletismografía estan compuestos por un diodo emisor
 y un receptor, transistor o fotodiodo, selectivo para la frecuencia emitida.
 Los circuitos para su polarización son los habituales: transistor en emisor
 común o conversor I--V para el fotodiodo.
\end_layout

\begin_layout Standard
Existen dos topolgías para la colocación de los sensores.
 Una de ellas es por transmisión (Figura 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Transmisión"

\end_inset

) donde el tejido u órgano sobre el que se quiere medir se coloca entre
 el emisor y el receptor.
 La otra forma es por reflexión (Figura 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Reflexión"

\end_inset

), el receptor se coloca al lado del emisor captando la luz que se refleja
 en los tejidos.
 El método de transmisión solo se puede utilizar en zonas donde el espesor
 del órgano o tejido es pequeño.
 Por tanto, lo mas habitual es hacerlo por reflexión.
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename /home/rafael/Documentos/4o Curso/8o Semestre/Trabajo Fin de Grado/img/transmision.png
	lyxscale 20
	width 20text%

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:Transmisión"

\end_inset

Transmisión
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename /home/rafael/Documentos/4o Curso/8o Semestre/Trabajo Fin de Grado/img/reflexion.png
	lyxscale 20
	width 20text%

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:Reflexión"

\end_inset

Reflexión
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
Topologías de colocación del sensor fotopletismográfico
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
El fotopletismograma obtenido es la superposición de varias señales como
 se observa en la Figura 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Componentes-del-fotopletismogram"

\end_inset

.
 Las componentes venosa de retorno, capilar y tejidos deben eliminarse con
 un filtro paso alta pues las pulsaciones sólo se pueden detectar sobre
 el flujo arterial.
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout
\align center
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename /home/rafael/Documentos/4o Curso/8o Semestre/Trabajo Fin de Grado/img/PPG-components-Reddy.png
	lyxscale 10
	width 50text%

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:Componentes-del-fotopletismogram"

\end_inset

Componentes del fotopletismograma
\end_layout

\end_inset


\end_layout

\end_inset


\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename /home/rafael/Documentos/4o Curso/8o Semestre/Trabajo Fin de Grado/img/pulsos-bn.jpg
	lyxscale 10
	width 50text%

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:Pulsos-obtenidos-desde"

\end_inset

Pulsos obtenidos desde fotopletismogama filtrado
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
Determinación de la frecuencia cardía mediante fotopletismograma
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
Se puede incluir otros elementos del filtrado para obtener una señal mas
 limpia.
 Filtros paso baja para limitar el ancho de banda y filtros elimina--banda
 o peine para reducir el efecto de la interferencia electromagnética con
 origen en la red eléctrica.
 Este ruido afecta sensiblemente a estos dispositivos ya que su frecuencia,
 50
\begin_inset space ~
\end_inset

Hz o 60
\begin_inset space ~
\end_inset

Hz, es cercana a la frecuencia cardíaca que está entorno a 1
\begin_inset space ~
\end_inset

Hz.
\end_layout

\begin_layout Standard
Finalmente, se detectan los pulsos con un comparador
\begin_inset CommandInset citation
LatexCommand cite
key "ramlee_low_2014"

\end_inset

 (Figura 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Pulsos-obtenidos-desde"

\end_inset

).
 Otras técnicas utilizan el análisis espectral, pero requieren hardware
 y software con potencia suficiente para realizar la transformada rápida
 de fourier
\begin_inset CommandInset citation
LatexCommand cite
key "zhang_heart_2014"

\end_inset

.
\end_layout

\begin_layout Section
Dispositivos comerciales
\end_layout

\begin_layout Standard
Existe una gran variedad de instrumentos portátiles para la medida de la
 frecuencia cardíaca basados principalmente en electrocardiograma y fotopletismo
grama.
\end_layout

\begin_layout Subsection
Primeros pulsómetros portátiles
\end_layout

\begin_layout Standard
El instrumento mas rudimentatio para la medida de las pulsaciones es el
 el propio ser humano.
 Cualquier persona puede 
\emph on
tomar el pulso
\emph default
 de si mismo o de otro posando su dedo sobre zonas donde los cambios de
 presión arteriales son palpables, habitualmente muñeca y cuello.
 El método consiste en contar los pulsos durante un periodo de tiempo, normalmen
te 1 minuto para obtener el dato en pulsaciones por minuto (PPM).
 Esta forma es poco eficiente pues al no ser automático el individuo que
 realiza el procedimiento debe prestar su atención durante el tiempo de
 la prueba y realizar tareas de monitorización se hacen inviables.
 En algunas ocasiones el pulso del sujeto es débil y puede ser difícil encontrar
lo
\end_layout

\begin_layout Standard
Otro método clásico para determinar las pulsaciones por minuto de un sujeto
 es utilizar un estetoscopio sobre el pecho de un paciente.
 Un estetoscopio, Figura 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Estetoscopio"

\end_inset

, es un dispositivo acústico para oir los sonidos internos del cuerpo.
 Este procedimiento solo puede ser aplicado por un especialista, que posee
 el instrumento adecuado y tiene el entrenamiento para realizarlo.
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename ../img/Stethoscope-bn.jpg
	lyxscale 25
	width 30text%

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:Estetoscopio"

\end_inset

Estetoscopio
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Pulsómetros basados en electrocardiograma
\end_layout

\begin_layout Standard
Todos los centros hospitalarios están equipados con instrmental para la
 realización de electrocardiogramas, Figura 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Electrocardiógrafo-portátil"

\end_inset

.
 Sin embargo su uso en este ámbito está mucho mas orientado al diagnóstico
 de enfermedades cardíacas mas que a la monitorización del pulso.
 El ECG proporciona mucha mas información al especialista a costa de de
 una preparación del paciente más compleja.
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename /home/rafael/Documentos/4o Curso/8o Semestre/Trabajo Fin de Grado/img/portable-ecg.jpg
	lyxscale 10
	width 30text%

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:Electrocardiógrafo-portátil"

\end_inset

Electrocardiógrafo portátil
\begin_inset CommandInset citation
LatexCommand cite
key "_role_????"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
Fuera del ámbito sanitario, en el mundo del deporte, existen mutitiud de
 dispositivos para monitorizar la frecuencia cardíaca
\begin_inset CommandInset citation
LatexCommand cite
key "_decathlon_????"

\end_inset

.
 Para un deportista es importante conocer su pulso porque indica el nivel
 de esfuerzo que está realizando.
 En el mercado hay una gran variedad con características adicionales como
 reloj, los más básicos y GPS o conexión con 
\emph on
smartphones
\emph default
, los más avanzados.
 Estos dispositivos son conocidos con el nombre de cardiógrafos y están
 compuestos de dos partes: una banda que se coloca sobre el pecho, que contiene
 el circuito para realizar el ECG y un emisor de radiofrecuencia, y un receptor
 que se coloca en la muñeca con una pantalla para mostrar la información
 (Figura 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Cardiofrecuencímetro-Cardio-ONrh"

\end_inset

).
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename ../img/cardiofrecuencimetro.jpg
	lyxscale 25
	width 30text%

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:Cardiofrecuencímetro-Cardio-ONrh"

\end_inset

Cardiofrecuencímetro 
\emph on
Cardio ONrhythm 50
\emph default
 de 
\emph on
Geonaute
\emph default

\begin_inset CommandInset citation
LatexCommand cite
key "_cardio_????"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
Los cardiofrecuencímetros son mucho más prácticos de usar que realizar un
 ECG convencional y se pueden utilizar mientras se hace deporte al aire
 libre.
 Sin embargo presentan algunos problemas orginados por la naturaleza eléctrica
 de la prueba:
\end_layout

\begin_layout Itemize
La zona del pecho donde se coloca la banda, a la altura del corazón, debe
 estar húmeda.
 Los electrodos necesitan un medio que favorezca la conducción eléctrica.
\end_layout

\begin_layout Itemize
Su uso está fuertemente desaconsejado en usuarios de marcapasos pues el
 cardiofrecuencímetro puede interferír sobre él.
 
\end_layout

\begin_layout Standard
Estos aparatos no se podrían usar para la monitorización muchas personas,
 sobre todo ancianas, que tienen problemas de corazón.
 Y son precisamente los cardiópatas los que mas lo necesitan.
\end_layout

\begin_layout Subsection
Pulsómetros basados en fotopletismograma
\end_layout

\begin_layout Standard
Los pulsómetros basados en foto pletismograma actualmente tienen su nicho
 en la monitorización hospitalaria, sin embargo ha habido y sigue habiendo
 intentos en universalizar su uso fuera de ese ámbito.
\end_layout

\begin_layout Standard
Uno de los primeros dispostivos de pulsimetría de uso no hospitalario es
 el reloj BP-400 fabricado por Casio en los años 90 del siglo XX, que ya
 incorporaba un sensor óptico para obtener las pulsaciones.
 el usuario debía colocar su dedo sobre la zona del sensor, Figura 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Casio-BP-400-(1994)"

\end_inset

, y esperar unos instantes hasta que la medida a pareciera en la pantalla
 LCD.
 Tuvo un exito limitado ya que requería calibrarlo para cada persona que
 fuera a utilizarlo
\begin_inset CommandInset citation
LatexCommand cite
key "_casio_????"

\end_inset

.
\end_layout

\begin_layout Standard
Dos décadas despues la empresa Apple comercializa un reloj inteligente,
 
\emph on
smartwatch
\emph default
, que incorpora un sensor pulsimétrico (Figura 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Apple-Watch-(2015)"

\end_inset

).
 En esta ocasión el dispositivo no requiere calibración y puede leer el
 pulso directamente desde la muñeca.
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename ../img/BP-400.jpg
	lyxscale 10
	width 30text%

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:Casio-BP-400-(1994)"

\end_inset

Casio BP-400 (1994)
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename ../img/apple-watch.jpg
	lyxscale 10
	width 30text%

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:Apple-Watch-(2015)"

\end_inset

Apple Watch (2015)
\end_layout

\end_inset


\end_layout

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
Evolución de relojes-pulsómetro
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
El fotopletismograma se puedede realizar sobre otras zonas del cuerpo como
 dedos y orejas.
\end_layout

\begin_layout Standard
\begin_inset Note Note
status open

\begin_layout Plain Layout
PINZA PULSIMETRICA EN DEDO
\end_layout

\begin_layout Plain Layout
PINZA SOBRE OREJA (a bebes)
\end_layout

\end_inset


\end_layout

\begin_layout Standard
El prinicpal aspecto de innovación de los pulsómetros PPG es la colocación
 del sensor, ya que si es correcta se reduce en gran medida los artefactos
 comentados en el apartado 
\begin_inset Note Note
status open

\begin_layout Plain Layout
XXXXXX
\end_layout

\end_inset

.
 Existen numerosas patentes y modelos de utilidad con invenciones interesantes
 en este ámbito.
\end_layout

\begin_layout Standard
\begin_inset Note Note
status open

\begin_layout Plain Layout
::::Buscar catálogo de siemens
\end_layout

\begin_layout Plain Layout
::::Buscar descripción del galaxy gear fit
\end_layout

\begin_layout Plain Layout
::::Wearable
\end_layout

\end_inset


\end_layout

\begin_layout Chapter
Diseño y desarrollo del sistema
\begin_inset CommandInset label
LatexCommand label
name "chap:Diseño-y-desarrollo"

\end_inset


\end_layout

\begin_layout Section
Introducción
\begin_inset CommandInset label
LatexCommand label
name "sec:Introducción-1"

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float figure
placement H
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset Graphics
	filename ../img/diagrama-sistema.svg
	lyxscale 5
	width 100text%
	rotateOrigin center

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:Diagrama-conceptual-del"

\end_inset

Diagrama conceptual del sistema
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
El sistema de pulsimetría desarrollado se compone de los elementos que se
 muestran en la Figura
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Diagrama-conceptual-del"

\end_inset

.
 Las flechas indican la relación de transferencia de información o energía
 entre los componentes.
\end_layout

\begin_layout Standard
Todos los documentos, esquemas y código fuente creados para el desarrollo
 de este Trabajo Fin de Grado se pueden encontrar bajo licencias libres
 en el repositorio del proyecto
\begin_inset CommandInset citation
LatexCommand cite
key "bailon-ruiz_rafael1193/tfg-heart-rate-monitor_????"

\end_inset

.
 
\end_layout

\begin_layout Section
Hardware
\begin_inset CommandInset label
LatexCommand label
name "sec:Hardware"

\end_inset


\end_layout

\begin_layout Standard

\end_layout

\begin_layout Standard
A continuación se describe y justifica de manera pormenorizada el diseño
 del 
\emph on
hardware
\emph default
 del pulsómetro, cuyo circuito es el de la Figura 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Circuito-del-pulsómetro"

\end_inset

.
\end_layout

\begin_layout Standard
\begin_inset Float figure
placement H
wide false
sideways false
status open

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout
\begin_inset Graphics
	filename ../img/circuito.svg
	lyxscale 25
	rotateAngle 90
	rotateOrigin center

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:Circuito-del-pulsómetro"

\end_inset

Circuito del pulsómetro
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Alimentación
\begin_inset CommandInset label
LatexCommand label
name "sub:Alimentación"

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center

\end_layout

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename ../img/circuito-alimentacion.svg

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:Circuito-de-alimentación"

\end_inset

Circuito de alimentación
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
El pulsómetro está diseñado para operar a una tensión regulada, 
\begin_inset Formula $V_{DD}$
\end_inset

, de 3,3V, alimentandose a partir de un sistema de baterías.
 La regulación la realiza el componente MCP1700
\begin_inset CommandInset citation
LatexCommand cite
key "_mcp1700_2013"

\end_inset

 que permite alimentar hasta 250
\begin_inset space ~
\end_inset

mA con un consumo de 1,6
\begin_inset space ~
\end_inset

µA (valor típico).
 Posee proteccion integrada contra corctocircuito y sobre calientamiento,
 y admite hasta 6
\begin_inset space ~
\end_inset

V en el terminal de entrada.
\end_layout

\begin_layout Standard
Se ha elegido utilizar un regulador en lugar de un conversor DC-DC, mas
 eficiente, ya que su diseño e implementación en el sistema se escapa de
 los objetivos de este Trabajo Fin de Grado.
 
\end_layout

\begin_layout Standard
La alimentación se realiza mediante 4
\begin_inset Note Note
status open

\begin_layout Plain Layout
¿o 3 baterías?
\end_layout

\end_inset

 baterías tipo AA de 1,5
\begin_inset space ~
\end_inset

V conectadas en serie, sumando 6
\begin_inset space ~
\end_inset

V en total.
 Siendo esta configuración muy habitual en dispositivos portátiles.
 Para el funcionamiento del regulador se necesita, segun el 
\emph on
datasheet
\emph default
, dos condensadores de 1
\begin_inset space ~
\end_inset

µF: 
\begin_inset Formula $C_{8}$
\end_inset

 y 
\begin_inset Formula $C_{5}$
\end_inset

 en la Figura 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Circuito-de-alimentación"

\end_inset

.
\end_layout

\begin_layout Standard
Finalmente, se incluye un LED polarizado adecuadamente como indicador de
 encendido.
\end_layout

\begin_layout Standard
\begin_inset Note Note
status open

\begin_layout Plain Layout
El consumo del sistema en funcionamiento es 
\end_layout

\end_inset


\begin_inset Note Note
status open

\begin_layout Plain Layout
Calcular consumo con el polimetro.
\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Adquisición
\begin_inset CommandInset label
LatexCommand label
name "sub:Adquisición"

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename ../img/circuito-adquisicion.svg

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:Circuito-de-adquisición"

\end_inset

Circuito de adquisición
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
La etapa de adquisición, Figura 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Circuito-de-adquisición"

\end_inset

, se encarga de convertir las pulsaciones de los vasos sanguíneos en una
 señal eléctrica.
 Para ello se utiliza el componente TCRT1010 (Figura XXXXXX), un sensor
 óptico reflectivo y salida con transistor.
 Este dispositivo emite luz infrarroja a 950
\begin_inset space ~
\end_inset

nm, parte de ella es reflejada por los vasos sanguineos y es recibida por
 el transistor que se activa con la luz recibida.
 Según la hoja de características el sensor óptico tiene incorporado un
 filtro que bloquea la luz visible.
\end_layout

\begin_layout Standard
El diodo emisor se ha polarizado para que pase por él una corriente 
\begin_inset Formula $I_{F}$
\end_inset

 de 10
\begin_inset space ~
\end_inset

mA.
 Según la Figura 3 del 
\emph on
datasheet
\emph default

\begin_inset CommandInset citation
LatexCommand cite
key "vishay_semiconductors_reflective_????"

\end_inset

, para dicha corriente la caida de tensión 
\begin_inset Formula $V_{F}$
\end_inset

 es 1,1
\begin_inset space ~
\end_inset

V.
 Con esta información, la resistencia de polarización 
\begin_inset Formula $R_{1}$
\end_inset

 viene dada por la Ecuación 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:polarización-diodo-sensor"

\end_inset

.
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
R_{1}=\frac{V_{DD}-V_{F}}{I_{F}}=220\,\Omega\label{eq:polarización-diodo-sensor}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
En el lado del transistor, la resistencia 
\begin_inset Formula $R_{2}$
\end_inset

 lo polariza.
 Para que el transistor esté siempre funcionando en zona activa, su tensión
 colector--emisor, 
\begin_inset Formula $V_{CE}$
\end_inset

, debe ser mayor que 0,3
\begin_inset space ~
\end_inset

V.
 Fijando el valor de 
\begin_inset Formula $R_{2}$
\end_inset

 a 
\begin_inset Formula $10\,k\Omega$
\end_inset

 se cumple este criterio.
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename ../img/TCRT1010.jpg
	lyxscale 20
	width 20text%

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
Componente TCRT1010
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Filtrado
\begin_inset CommandInset label
LatexCommand label
name "sub:Filtrado"

\end_inset


\end_layout

\begin_layout Standard
La señal eléctrica obtenida en la fase de adquisición es muy débil: su amplitud
 es del orden de 10
\begin_inset space ~
\end_inset

mV y está superpuesta a una señal contínua.
 En esta fase del procesado, se adecúa la onda para poder identificar los
 pulsos en la fase posterior.
\end_layout

\begin_layout Subsubsection
Filtro paso alta
\begin_inset CommandInset label
LatexCommand label
name "sub:Filtro-paso-alta"

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename ../img/circuito-f-pasoalta.svg

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:Circuito-del-filtro-p-alta"

\end_inset

Circuito del filtro paso alta
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
El filtro paso alta, Figura 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Circuito-del-filtro-p-alta"

\end_inset

 elimina la componente continua de la señal debida a la polarización del
 transistor y otras componentes no deseadas.
 
\begin_inset Note Note
status open

\begin_layout Plain Layout
(la reflexión de los tejidos, el flujo capilar y el flujo venoso)
\end_layout

\end_inset

Con uno de tipo pasivo, de primer orden, y frecuencia de corte 
\begin_inset Formula $f_{PA}$
\end_inset

 a 0,41
\begin_inset space ~
\end_inset

Hz es suficiente para alzancanzar los requerimientos exigidos.
 La función de transferencia del filtro es la descrita en la Ecuación 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:f-transferencia-paso-alta"

\end_inset


\begin_inset CommandInset citation
LatexCommand cite
key "sedra_microelectronic_2011"

\end_inset

, donde 
\begin_inset Formula $\omega_{0}=\nicefrac{1}{2\pi f_{_{PA}}}$
\end_inset

.
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
T_{PA}(j\omega)=\frac{K}{1-j\left(\frac{\omega_{PA}}{\omega}\right)}\label{eq:f-transferencia-paso-alta}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
Al ser un filtro RC, los valores de los componentes, Tabla 
\begin_inset CommandInset ref
LatexCommand ref
reference "tab:Valores-filtro-paso-alta"

\end_inset

, se pueden calcular mediante la Ecuación 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:corte-paso-alta"

\end_inset

.
 Se fija en primer lugar la capacidad del condensador, ya que hay menos
 valores disponibles y se despeja 
\begin_inset Formula $R$
\end_inset

 de la Ecuación 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:corte-paso-alta"

\end_inset

.
 La constante 
\begin_inset Formula $K$
\end_inset

, de ganancia, es 1 ya que se trata de un filtro pasivo.
 La tolerancia de los componentes no influye significativamente en el desempeño.
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
f_{PA}=\frac{1}{2\pi\omega_{PA}}=\frac{1}{2\pi RC}\label{eq:corte-paso-alta}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float table
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Tabular
<lyxtabular version="3" rows="3" columns="2">
<features rotate="0" tabularvalignment="middle">
<column alignment="center" valignment="top">
<column alignment="decimal" decimal_point="." valignment="top">
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Componente
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Valor
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $C_{1}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $470\,nF$
\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $R_{3}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $820\,k\Omega$
\end_inset


\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "tab:Valores-filtro-paso-alta"

\end_inset

Valores de los componentes del filtro paso alta
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Note Note
status open

\begin_layout Plain Layout
En la Figura 
\begin_inset Note Note
status open

\begin_layout Plain Layout
insertar figura de simulación
\end_layout

\end_inset

 se muestra la simulación del filtro realizada con el programa 
\emph on
SpiceGUI
\emph default
, una interfaz gráfica del simulador 
\emph on
ngspice
\emph default
 para sistemas operativos GNU/Linux.
\end_layout

\end_inset


\end_layout

\begin_layout Subsubsection
Filtro paso baja y amplificación
\begin_inset CommandInset label
LatexCommand label
name "sub:Filtro-paso-baja"

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename ../img/circuito-f-pasobaja.svg

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:Circuito-del-filtro-p-baja"

\end_inset

Circuito del filtro paso baja con amplificación
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
En esta etapa se limita el ancho de banda y se amplifica la señal.
 Está compuesta por un filtro paso baja RC activo de primer órden, con ganancia,
 como se muestra en la Figura 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Circuito-del-filtro-p-baja"

\end_inset

.
\end_layout

\begin_layout Standard
La frecuencia de corte 
\begin_inset Formula $f_{PB}$
\end_inset

 escogida es 41
\begin_inset space ~
\end_inset

Hz, suficiente tratandose de un sistema para monitorización y no diagnóstico.
 Se elimina el ruido significativamente a cambio de perden componentes de
 frecuencias superiores a la de corte.
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
T_{PB}(j\omega)=\frac{K}{1+j\left(\frac{\omega}{\omega_{PB}}\right)}\label{eq:f-transferencia-paso-baja}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
A partir de la función de transferencia del filtro paso baja de primer órden
\begin_inset CommandInset citation
LatexCommand cite
key "sedra_microelectronic_2011"

\end_inset

, Ecuación 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:f-transferencia-paso-baja"

\end_inset

, y sabiendo que es de tipo RC, se obtiene la expresión que relaciona la
 frecuencia de corte con los valores de R y C, Ecuación 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:corte-paso-baja"

\end_inset

.
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
f_{PB}=\frac{1}{2\pi\omega_{PB}}=\frac{1}{2\pi RC}\label{eq:corte-paso-baja}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
Como la señal de de entrada tiene amplitud del orden de 10
\begin_inset space ~
\end_inset

mV y la tensión de alimentación es 3,3
\begin_inset space ~
\end_inset

V, la ganancia mas adecuada se encuentra entorno a 
\begin_inset Formula $K=200$
\end_inset

 para aprovechar todo el rango disponible.
 El filtro con amplificación de la Figura 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Circuito-del-filtro-p-baja"

\end_inset

 está en configuración no inversora y por tanto el factor de amplificación
 viene determinado por la Ecuación 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:ganancia-paso-baja"

\end_inset

.
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
K=1+\frac{R_{4}}{R_{5}}\label{eq:ganancia-paso-baja}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
Fijando 
\begin_inset Formula $C_{2}$
\end_inset

 y 
\begin_inset Formula $K$
\end_inset

, se obtienen los valores del resto de componentes mediante las Ecuaciones
 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:corte-paso-baja"

\end_inset

 y 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:ganancia-paso-baja"

\end_inset

, Tabla 
\begin_inset CommandInset ref
LatexCommand ref
reference "tab:Valores-filtro-paso-baja-amplificacion"

\end_inset

.
 
\begin_inset Formula $K$
\end_inset

 está ajustada para que 
\begin_inset Formula $R_{5}$
\end_inset

 coincida con un valor comercial.
 La tolerancia de los componentes no influye significativamente en el desempeño.
\end_layout

\begin_layout Standard
\begin_inset Float table
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Tabular
<lyxtabular version="3" rows="5" columns="2">
<features rotate="0" tabularvalignment="middle">
<column alignment="center" valignment="top">
<column alignment="decimal" decimal_point="." valignment="top">
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Componente
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Valor
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $C_{2}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $4,7\,nF$
\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $R_{4}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $820\,k\Omega$
\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $K$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $174$
\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $R_{5}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $4,7\,k\Omega$
\end_inset


\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "tab:Valores-filtro-paso-baja-amplificacion"

\end_inset

Valores de los componentes del filtro paso baja con amplificación
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Note Note
status open

\begin_layout Plain Layout
En la Figura 
\begin_inset Note Note
status open

\begin_layout Plain Layout
insertar figura de simulación
\end_layout

\end_inset

 se muestra la simulación de la función de transferencia del filtro paso
 baja con amplificación.
\end_layout

\end_inset


\end_layout

\begin_layout Standard
El amplificador operacional escogido es el TLV2472
\begin_inset CommandInset citation
LatexCommand cite
key "texas_instruments_family_2007"

\end_inset

 por permitir usar alimentación asimétrica y ser 
\emph on
rail-to-rail
\emph default
, importante al trabajar con baterías y con rangos de voltaje limitados
 como es el caso.
\end_layout

\begin_layout Subsubsection
Filtro rechaza banda
\begin_inset CommandInset label
LatexCommand label
name "sub:Filtro-rechaza-banda"

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename ../img/circuito-f-notch.svg

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:Circuito-del-filtro-notch"

\end_inset

Circuito del filtro rechaza banda estrecho centrado a 50Hz
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
Cualquier dispositivo electrónico que procese señales de baja frecuencia,
 como ocurre con el pulsómetro, se ve sometido de manera significativa al
 ruido electromagnético con produce la red eléctrica.
 Esta interferencia de frecuencia 50
\begin_inset space ~
\end_inset

Hz, 60 Hz en otros lugares del mundo, debe ser atenuada lo máximo posible.
\end_layout

\begin_layout Standard
El pulsómetro incluye un circuito elimina banda selectivo a 50Hz para eliminar
 este ruido, Figura 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Circuito-del-filtro-notch"

\end_inset

.
 Se ha escogido la topología 
\emph on
Fliedge
\emph default
 por varias ventajas
\begin_inset CommandInset citation
LatexCommand cite
key "carter_high-speed_2006"

\end_inset

:
\end_layout

\begin_layout Itemize
Solo se requieren 4 componentes precisos, dos resistencias y dos condensadores
 para ajustar la frecuencia central.
\end_layout

\begin_layout Itemize
Pequeños desajustes en el emparejamiento de los componentes afecta a la
 frecuencia central, pero no a la profundidad del rechazo.
\end_layout

\begin_layout Itemize
La frecuencia central puede ajustarse independientemente del factor de calidad
 del filtro.
\end_layout

\begin_layout Standard
Estas características hacen que se pueda incluir el potenciómetro 
\begin_inset Formula $R_{14}$
\end_inset

para ajustar la frecuencia central manteniendo buenas prestaciones.
\end_layout

\begin_layout Standard
Los valores de los componentes se han calculado usando una herramienta online
\begin_inset CommandInset citation
LatexCommand cite
key "_notch_????"

\end_inset

 con los datos de la Tabla 
\begin_inset CommandInset ref
LatexCommand ref
reference "tab:Requisitos-del-filtro-fliedge"

\end_inset

.
\end_layout

\begin_layout Standard
\begin_inset Float table
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Tabular
<lyxtabular version="3" rows="6" columns="2">
<features rotate="0" tabularvalignment="middle">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Dato
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Valor
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Frecuencia central
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $50\,Hz$
\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Factor de calidad (
\emph on
Q
\emph default
)
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
10
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Serie de resistencias
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
E24
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Serie de condensadores
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
E6
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Escala de las resistencias
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $10000\,\Omega$
\end_inset


\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "tab:Requisitos-del-filtro-fliedge"

\end_inset

Requisitos del filtro rechaza banda con topolgía 
\emph on
Fliedge
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
En la Tabla 
\begin_inset CommandInset ref
LatexCommand ref
reference "tab:Valores-de-resistencias-fliedge"

\end_inset

 están los resultados del cálculo.
\end_layout

\begin_layout Standard
\begin_inset Float table
wide false
sideways false
status open

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout
\align center
\begin_inset Tabular
<lyxtabular version="3" rows="4" columns="2">
<features rotate="0" tabularvalignment="middle">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Componente
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Valor
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $R_{8}\,R_{9}\,R_{10}\,R_{11}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $47\,k\Omega$
\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $R_{6}\,R_{7}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $931\,k\Omega$
\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $C_{3}\,C_{4}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $68\,nF$
\end_inset


\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "tab:Valores-de-resistencias-fliedge"

\end_inset

Valores de resistencias y condensadores del filtro rechaza banda con topología
 
\emph on
Fliedge
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
Los amplificadores operacionales no requieren características especiales.
 Se mantiene el TLV2472 para mantener el rango 
\emph on
rail-to-rail
\emph default
.
\end_layout

\begin_layout Subsection
Discretizado
\begin_inset CommandInset label
LatexCommand label
name "sub:Discretizado"

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename ../img/circuito-comparador.svg

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:Circuito-comparador"

\end_inset

Circuito comparador
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
La fase de discretizado, Figura 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Circuito-comparador"

\end_inset

, consiste en convertir la señal del PPG en pulsos digitales.
 La técnica escogida para ello es utilizar un comparador cuya salida salte
 entre 
\begin_inset Formula $V_{DD}$
\end_inset

 y 
\begin_inset Formula $GND$
\end_inset

 en función del umbral fijado por el potenciómetro 
\begin_inset Formula $R_{13}$
\end_inset

.
\end_layout

\begin_layout Standard
Los pulsos de salida de la fase de discretizado son leidos por el microcontrolad
or a través del pin 
\emph on
CCP1
\emph default
 .
\end_layout

\begin_layout Subsection
Microcontrolador
\begin_inset CommandInset label
LatexCommand label
name "sub:Microcontrolador"

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename ../img/circuito-microcontrolador.svg

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
Microcontrolador y circuito auxiliar 
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
El microcontrolador se encarga de tomar los pulsos, procesarlos y transmitir
 el resultado al módulo de comunicación.
 En este apartado se describe las conexiones eléctricas entre microcontrolador
 y otros elementos del sistema.
\end_layout

\begin_layout Standard
El procesador utilizado es un PIC18LF2553, en encapsulado de 28 pines, que
 permite el funcionamiento a 3,3
\begin_inset space ~
\end_inset

V.
\end_layout

\begin_layout Standard
Entre los pines 9, 
\emph on
OSC1
\emph default
, y 10, 
\emph on
OSC2
\emph default
, se conecta el oscilador, de 20
\begin_inset space ~
\end_inset

Mhz, y los condensadores necesarios, 
\begin_inset Formula $C_{6}$
\end_inset

y 
\begin_inset Formula $C_{7}$
\end_inset

, que según la hoja de características deben ser de 15pF
\begin_inset CommandInset citation
LatexCommand cite
key "microcontrollers_28/40/44-pin_2007"

\end_inset

.
 El pin 13 recibe los pulsos a través del interfaz CCP
\begin_inset CommandInset nomenclature
LatexCommand nomenclature
symbol "CCP"
description "Capture, Compare, and PWM"

\end_inset

.
 
\end_layout

\begin_layout Standard
Se ha incorporado un conector para la interfaz ICSP
\begin_inset CommandInset nomenclature
LatexCommand nomenclature
symbol "ICSP"
description "In-Circuit Serial Programming"

\end_inset

, que permite reprogramar el firmware.
\end_layout

\begin_layout Standard
Los pines 17, 
\emph on
TX
\emph default
, y 18, 
\emph on
RX
\emph default
, conectan el microcontrolador con el módulo de comunicación mediante interfaz
 UART
\begin_inset CommandInset nomenclature
LatexCommand nomenclature
symbol "UART"
description "Universal Asynchronous Receiver-Transmitter"

\end_inset

.
\end_layout

\begin_layout Subsection
Módulo de comunicación
\begin_inset CommandInset label
LatexCommand label
name "sub:Módulo-de-comunicación"

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename ../img/RN-42 bluetooth module.jpg
	lyxscale 20
	width 50text%

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:Módulo-de-comunicación"

\end_inset

Módulo de comunicación Bluetooth RN-42
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
El módulo de comunicación es un dispositivo Bluetooh modelo RN42 como el
 de la Figura 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Módulo-de-comunicación"

\end_inset

.
 Recibe mediante UART las pulsaciones por minuto del paciente y las envía
 inalámbricamente al smartphone.
\end_layout

\begin_layout Standard
Por defecto la velocidad de transmisión a través de la interfaz serie es
 115200
\begin_inset space ~
\end_inset

baudios
\begin_inset CommandInset citation
LatexCommand cite
key "roving_networks_roving_2009"

\end_inset

.
\end_layout

\begin_layout Subsection
Placa de circuito impreso
\end_layout

\begin_layout Standard
La placa de circuito impreso, Figura 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Placa-de-circuito"

\end_inset

, integra los circuitos analógicos, el microcontrolador y el módulo de comunicac
iones bluetooth.
 No se ha podido realizar su implementación física por falta de tiempo pero
 se puede construir usando los archivos 
\emph on
gerber
\emph default
 que se encuentran en el repositorio del proyecto.
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename /home/rafael/Documentos/4o Curso/8o Semestre/Trabajo Fin de Grado/img/pulsometro_pcb.svg
	lyxscale 10

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:Placa-de-circuito"

\end_inset

Placa de circuito impreso
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Section
Firmware
\begin_inset CommandInset label
LatexCommand label
name "sec:Firmware"

\end_inset


\end_layout

\begin_layout Standard
El firmware está compuesto por el software del microcontrolador, que se
 encarga de medir el periodo entre pulsos y enviar este dato al módulo bluetooth.
\end_layout

\begin_layout Standard
El codigo fuente del microcontrolador, escrito en C, se encuentra en carpeta
 
\family typewriter
\size small
/src/pulsometro.X
\family default
\size default
 del proyecto.
 Es necesario el compilador XC8 y se ha utilizado el IDE
\begin_inset CommandInset nomenclature
LatexCommand nomenclature
symbol "IDE"
description "Integrated Development Environment"

\end_inset

 MPLAB X para su desarrollo.
\end_layout

\begin_layout Standard
El programa se distribuirse bajo los términos de la licencia 
\emph on
GNU GPL versión 3 o posterior
\emph default
 (el texto completo de la licencia se encuentra en el archivo 
\family typewriter
\size small
/src/LICENSE
\family default
\size default
)
\end_layout

\begin_layout Subsection
Configuración del oscilador
\begin_inset CommandInset label
LatexCommand label
name "sub:Configuración-del-oscilador"

\end_inset


\end_layout

\begin_layout Standard
Al utilizar un oscilador externo, hay que indicar al compilador que active
 los bits de configuración necesarios para que lo utilice.
 Esto se realiza mediante directivas del compilador del tipo 
\family typewriter
\size small
#pragma config 
\emph on
configuración
\emph default
 = 
\emph on
valor
\family default
\size default
\emph default
.
 El IDE MPLAB X permite establecer estas directivas en el proyecto mediante
 una interfaz gráfica que se lanza haciendo click en el menu 
\family sans
Window \SpecialChar \menuseparator
 PIC Memory Views \SpecialChar \menuseparator
 Configuration Bits
\family default
.
 Este método hace mas sencilla la configuración porque muestra la descripcion
 de caa configuracion y los valores disponibles.
 De esta manera no hay que consultar la documentación del compilador XC8.
\end_layout

\begin_layout Standard
Las directivas modifcadas para configurar el oscilador externo a 20
\begin_inset space ~
\end_inset

Mhz son las que aparecen en el Listado 
\begin_inset CommandInset ref
LatexCommand ref
reference "lis:Directivas-del-compilador"

\end_inset

, que es un extracto del archivo 
\family typewriter
\size small
configuration_bits.c
\family default
\size default
.
\end_layout

\begin_layout Standard
\begin_inset Float listing
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset listings
lstparams "language=C,basicstyle={\footnotesize},breaklines=true,tabsize=4,extendedchars=true"
inline false
status open

\begin_layout Plain Layout

// Selección del Postscaler (Dividir por 1)
\end_layout

\begin_layout Plain Layout

#pragma config CPUDIV = OSC1_PLL2
\end_layout

\begin_layout Plain Layout

// Selección del oscilador (Oscilador HS)
\end_layout

\begin_layout Plain Layout

#pragma config FOSC = HS
\end_layout

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "lis:Directivas-del-compilador"

\end_inset

Directivas del compilador para configurar el oscilador a 20
\begin_inset space ~
\end_inset

MHz
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
Además, para que funcionen algunas bibliotecas y macros, es necesario definir
 la frecuencia del oscilador que se está utilizando con el código del Listado
 
\begin_inset CommandInset ref
LatexCommand ref
reference "lis:Macros-para-definir"

\end_inset

.
\end_layout

\begin_layout Standard
\begin_inset Float listing
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset listings
lstparams "language=C,basicstyle={\footnotesize},breaklines=true,tabsize=4,extendedchars=true"
inline false
status open

\begin_layout Plain Layout

#define _XTAL_FREQ	20000000
\end_layout

\begin_layout Plain Layout

#define SYS_FREQ	20000000L
\end_layout

\begin_layout Plain Layout

#define FCY			SYS_FREQ/4
\end_layout

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "lis:Macros-para-definir"

\end_inset

Macros para definir la frecuencia del oscilador
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Medida de las pulsaciones
\begin_inset CommandInset label
LatexCommand label
name "sub:Medida-de-las"

\end_inset


\end_layout

\begin_layout Standard
El cálculo de las pulsaciones por minuto instantáneas se realiza midiendo
 el periodo entre latidos.
 El microcontrolador escogido viene con un módulo CCP integrado
\begin_inset CommandInset citation
LatexCommand cite
key "microcontrollers_28/40/44-pin_2007"

\end_inset

, que entre otras cosas, permite medir, con ayuda del 
\emph on
Timer 1
\emph default
, el tiempo que transcurre entre pulsos que lleguen al pin CCP1.
\end_layout

\begin_layout Standard
El sistema CCP debe estar configurado en modo 
\emph on
Capture
\emph default
.
 En esta situación, el registro CCPR1 se carga con el valor de TMR1 cuando
 ocurre un flanco en el pin CCP1.
 Para medir el periodo de una señal los pasos son los siguientes
\begin_inset CommandInset citation
LatexCommand cite
key "microcontrollers_picmicro_2003"

\end_inset

:
\end_layout

\begin_layout Enumerate
Configurar los bits de control CCP1M3:CCP1M0 para capturar los flancos de
 subida.
\end_layout

\begin_layout Enumerate
Configurar el 
\emph on
prescaler
\emph default
 del 
\emph on
Timer 1
\emph default
 para aumentar el tiempo máximo que puede contar.
 Al estar midiendo una señal de muy baja frecuencia, entorno a 1
\begin_inset space ~
\end_inset

Hz, inevitablemente el registro TMR1, de 16 bits, se desbordará.
\end_layout

\begin_layout Enumerate
Activar las interrupciones CCP poniendo a 1 el bit CCP1IE.
\end_layout

\begin_layout Enumerate
Cuando ocurra una interrupción CCP:
\end_layout

\begin_deeper
\begin_layout Enumerate
Almacenar el valor del registro CCPR1.
\end_layout

\begin_layout Enumerate
Resetear el 
\emph on
Timer 1
\emph default
 poniendo a cero el registro TMR1.
\end_layout

\begin_layout Enumerate
Limpiar la bandera CCP1IF.
\end_layout

\begin_layout Enumerate
Limpiar la bandera TMR1F, por si estuviera activa.
\end_layout

\end_deeper
\begin_layout Enumerate
Cuando ocurre un interrupción por desbordamiento del 
\emph on
Timer 1
\emph default
:
\end_layout

\begin_deeper
\begin_layout Enumerate
Almacenar el número de veces que TMR1 se ha desbordado desde la última interrupc
ión CCP (
\begin_inset Formula $N_{desbordamientos}$
\end_inset

).
\end_layout

\begin_layout Enumerate
Limpiar la bandera TMR1F.
\end_layout

\end_deeper
\begin_layout Standard
El periodo de los latidos, en unidades de ciclo de reloj, se calcula según
 la Ecuación 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:periodo-en-ciclos"

\end_inset

.
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
periodo=CCPR1+\left(65536*N_{desbordamientos}\right)\label{eq:periodo-en-ciclos}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
En el Listado 
\begin_inset CommandInset ref
LatexCommand ref
reference "lis:Configuración-del-Timer-1"

\end_inset

, se configura el 
\emph on
Timer 1
\emph default
 en modo 16 bits y preescala de 
\begin_inset Formula $\nicefrac{1}{8}$
\end_inset

 para conseguir los mínimos desbordamientos.
 
\end_layout

\begin_layout Standard
\begin_inset Float listing
wide false
sideways false
status open

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout
\begin_inset listings
lstparams "language=C,basicstyle={\footnotesize},tabsize=4"
inline false
status open

\begin_layout Plain Layout

TMR1 = 0;					// Pone a 0 el regsitro TMR1
\end_layout

\begin_layout Plain Layout

T1CONbits.RD16 = 1;			// 1: Modo 16 bits
\end_layout

\begin_layout Plain Layout

T1CONbits.T1CKPS = 0b11;	// 0b11: Preescala 1/8
\end_layout

\begin_layout Plain Layout

T1CONbits.TMR1CS = 0;		// 0: Reloj interno
\end_layout

\begin_layout Plain Layout

T1CONbits.TMR1ON = 1;		// 1: Activa el Timer1
\end_layout

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "lis:Configuración-del-Timer-1"

\end_inset

Configuración del 
\emph on
Timer 1
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
En el Listado 
\begin_inset CommandInset ref
LatexCommand ref
reference "lis:Configuración-del-modo-CCP"

\end_inset

 se inicializa el módulo CCP para capturar los flancos de subida.
\end_layout

\begin_layout Standard
\begin_inset Float listing
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset listings
lstparams "language=C,basicstyle={\footnotesize},tabsize=4"
inline false
status open

\begin_layout Plain Layout

CCP1CONbits.CCP1M = 0b0101; // 0101: Captura cada flanco de subida
\end_layout

\begin_layout Plain Layout

PIE1bits.CCP1IE = 1;		// 1: Activa las interrupciones CCP
\end_layout

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "lis:Configuración-del-modo-CCP"

\end_inset

Configuración del modo CCP
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
El manejo de las interrupciones se realiza en la función 
\family typewriter
\size small
high_isr()
\family default
\size default
 que se ejecuta cada vez que se activa una interrupción.
 Discriminar cual de las interrupciones se ha lanzado corresponde al programador
: Hay que comprobar las banderas y los bits de activación de las interrupciones
 que se desean manejar.
 En esta función no se deben realizar muchos cálculos ya que su ejecución
 paraliza el flujo normal del programa e impide manejar otras interrupciones
 que se lancen mientras se ejecuta.
\end_layout

\begin_layout Standard
La implementación del conteo de pulsos se encuentra en el Listado 
\begin_inset CommandInset ref
LatexCommand ref
reference "lis:Obtención-del-periodo"

\end_inset

.
 Solo queda por destacar de ella que se desprecian los pulsos cuyo periodo
 no esté comprendido entre 187500 y 937500 pulsos, que corresponden respectivame
nte a 40 y 200 pulsaciones por minuto.
\end_layout

\begin_layout Standard
\begin_inset Float listing
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset listings
lstparams "language=C,basicstyle={\footnotesize},breaklines=true,tabsize=4"
inline false
status open

\begin_layout Plain Layout

/* Timer1
\end_layout

\begin_layout Plain Layout

 * timer1_ov_count se incrementa cada vez que timer1 se desborda para
\end_layout

\begin_layout Plain Layout

 * poder registrar intervalos mayores de tiempo a 65536 pulsos
\end_layout

\begin_layout Plain Layout

 */
\end_layout

\begin_layout Plain Layout

if(T1CONbits.TMR1ON && PIR1bits.TMR1IF) {
\end_layout

\begin_layout Plain Layout

    timer1_ov_count += 1;
\end_layout

\begin_layout Plain Layout

    PIR1bits.TMR1IF = 0;
\end_layout

\begin_layout Plain Layout

}
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

/* CCP interrupt handler
\end_layout

\begin_layout Plain Layout

 * Cuando llega un flanco de subida, se almacena en CCPR1 el valor de TMR1
\end_layout

\begin_layout Plain Layout

 * y se resetea.
 El valor de CCPR1 es el periodo de la señal.
 Se tiene en
\end_layout

\begin_layout Plain Layout

 * cuenta el desbordamiento que se hubiera producido en timer1 entre pulsos
\end_layout

\begin_layout Plain Layout

 * 
\end_layout

\begin_layout Plain Layout

 * TMR1 debe resetearse manualmente.
\end_layout

\begin_layout Plain Layout

 */
\end_layout

\begin_layout Plain Layout

if (PIE1bits.CCP1IE && PIR1bits.CCP1IF) {
\end_layout

\begin_layout Plain Layout

    period_tmp = CCPR1 + (65536 * timer1_ov_count);
\end_layout

\begin_layout Plain Layout

    /* Almacena el valor del periodo si está entre 40 y 200 PPM */
\end_layout

\begin_layout Plain Layout

    if(period_tmp >= 0x02DC6C && period_tmp <= 0x0E4E1C) {
\end_layout

\begin_layout Plain Layout

        period = period_tmp;
\end_layout

\begin_layout Plain Layout

    }
\end_layout

\begin_layout Plain Layout

    timer1_ov_count = 0;
\end_layout

\begin_layout Plain Layout

    TMR1 = 0;
\end_layout

\begin_layout Plain Layout

    PIR1bits.CCP1IF = 0;
\end_layout

\begin_layout Plain Layout

    PIR1bits.TMR1IF = 0;
\end_layout

\begin_layout Plain Layout

}
\end_layout

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "lis:Obtención-del-periodo"

\end_inset

Obtención del periodo de los latidos
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
El valor que almacena la variable periodo es el periodo en unidades de ciclo
 de reloj.
 Para convertirlo a pulsaciones por minuto se hace según las Ecuaciones
 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:periodo-en-segundos"

\end_inset

 y 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:periodo-en-ppm"

\end_inset

, donde 
\begin_inset Formula $T(s)$
\end_inset

 es el periodo en segundos; 
\begin_inset Formula $T(ciclos)$
\end_inset

, el periodo en ciclos; 
\begin_inset Formula $preescala_{Timer1}$
\end_inset

, el valor del 
\emph on
preescaler
\emph default
 del 
\emph on
Timer 1
\emph default
; 
\begin_inset Formula $T_{clk}$
\end_inset

, el periodo de un ciclo de reloj del micorcontrolador y 
\begin_inset Formula $PPM$
\end_inset


\begin_inset CommandInset nomenclature
LatexCommand nomenclature
symbol "PPM"
description "Pulsaciones Por Minuto"

\end_inset

 el pulso medido en pulsaciones por minuto.
 Este cálculo se computa en el momento en el que se va a enviar el dato
 al módulo de comunicaciones.
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
T\left(s\right)=T\left(ciclos\right)\cdot preescala_{Timer1}\cdot4\cdot T_{clk}=T\left(ciclos\right)\cdot8\cdot4\cdot\left(0,05\cdot10^{-6}\right)\label{eq:periodo-en-segundos}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
PPM=\frac{60}{T(s)}\label{eq:periodo-en-ppm}
\end{equation}

\end_inset


\end_layout

\begin_layout Subsection
Envío de datos al módulo de comunicaciones
\begin_inset CommandInset label
LatexCommand label
name "sub:Envío-de-datos"

\end_inset


\end_layout

\begin_layout Standard
La última fase del proceso en el microcontrolador es enviar las pulsaciones
 por minuto al módulo de comunicaciones para que las transmita al 
\emph on
smartphone
\emph default
.
\end_layout

\begin_layout Standard
Esta transmisión se hace mediante la interfaz UART y para configrarla se
 ha utilizado la biblioteca 
\family typewriter
\size small
uart.h
\family default
\size default
 que incluye el compilador XC8.
\end_layout

\begin_layout Standard
Para inicializar la comunicación se llama a la función 
\family typewriter
\size small
OpenUSART
\family default
\size default
 con las banderas que se quieren activar como se hace en el Listado 
\begin_inset CommandInset ref
LatexCommand ref
reference "lis:Configuración-de-UART"

\end_inset

.
\end_layout

\begin_layout Standard
\begin_inset Float listing
wide false
sideways false
status open

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout
\begin_inset listings
lstparams "language=C,basicstyle={\footnotesize},breaklines=true,tabsize=4"
inline false
status open

\begin_layout Plain Layout

const unsigned SPBRG = 10;
\end_layout

\begin_layout Plain Layout

OpenUSART( USART_TX_INT_OFF  & // Desactiva interrupción TX
\end_layout

\begin_layout Plain Layout

           USART_RX_INT_OFF  & // Desactiva interrupción RX
\end_layout

\begin_layout Plain Layout

           USART_ASYNCH_MODE & // Modo asíncrono
\end_layout

\begin_layout Plain Layout

           USART_EIGHT_BIT   & // Sin bit de paridad
\end_layout

\begin_layout Plain Layout

           USART_BRGH_HIGH,    // Transmisión de alta velocidad
\end_layout

\begin_layout Plain Layout

           SPBRG              );
\end_layout

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "lis:Configuración-de-UART"

\end_inset

Configuración de la interfaz UART
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
El registro SPBRG permite configurar la velocidad de transmisión (
\emph on
baud rate
\emph default
).
 En función de las banderas de configuración activadas, su valor genera
 velocidades distintas.
 Según la hoja de características
\begin_inset CommandInset citation
LatexCommand cite
key "microcontrollers_28/40/44-pin_2007"

\end_inset

 para conseguir los 115200
\begin_inset space ~
\end_inset

baudios que requiere el módulo bluetooth el valor de SPBRG debe ser 10.
\end_layout

\begin_layout Standard
Para enviar un byte a través de UART se llama a la función 
\family typewriter
\size small
WriteUSART()
\family default
\size default
 que acepta un byte como argumento.
 El dato de pulsaciones por minuto, que siempre estará entre 40 y 200 se
 puede codificar sin problemas con un solo byte lo que simplifica la comunicació
n.
\end_layout

\begin_layout Standard
El envío de información se debe hacer periodicamente.
 Para ello se configura el 
\emph on
Timer 0
\emph default
 con el objetivo de activar una señal cada varios segundos (Listado
\begin_inset CommandInset ref
LatexCommand ref
reference "lis:Configuración-del-Timer"

\end_inset

).
 El tiempo de desbordamieno de este temporizador viene determinado por la
 Ecuación 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:desbordamiento-timer0"

\end_inset

.
 
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
T_{desbordamiento}=4\cdot T_{clk}\cdot256\cdot TOPS=4\cdot\left(0,05\cdot10^{-6}\right)\cdot256\cdot256=13\,ms\label{eq:desbordamiento-timer0}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float listing
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset listings
lstparams "language=C,basicstyle={\footnotesize},breaklines=true,tabsize=4"
inline false
status open

\begin_layout Plain Layout

TMR0L = 0;
\end_layout

\begin_layout Plain Layout

T0CONbits.T0PS0 = 1;
\end_layout

\begin_layout Plain Layout

T0CONbits.T0PS1 = 1;
\end_layout

\begin_layout Plain Layout

T0CONbits.T0PS2 = 1; //TOPS2:TOPS0 -> 1/256
\end_layout

\begin_layout Plain Layout

T0CONbits.PSA = 0;   // 0: Usar prescaler
\end_layout

\begin_layout Plain Layout

T0CONbits.T0CS = 0;  // 0: Usar reloj interno -> Fosc/4
\end_layout

\begin_layout Plain Layout

T0CONbits.TMR0ON = 1;
\end_layout

\begin_layout Plain Layout

T0CONbits.T08BIT = 1;
\end_layout

\begin_layout Plain Layout

INTCONbits.TMR0IE = 1;
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "lis:Configuración-del-Timer"

\end_inset

Configuración del 
\emph on
Timer 0
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
En la funcion 
\family typewriter
high_isr()
\family default
 se añade el código para detectar los desbordamientos del 
\emph on
Timer 0
\emph default
 (Listado
\begin_inset CommandInset ref
LatexCommand ref
reference "lis:Manejo-del-desbordamiento"

\end_inset

).
 Cada 152 desbordamientos transcurren 2 segundos aproximadamente y se activa
 la variable 
\family typewriter
\size small
send_value
\family default
\size default
, que indica al código de la función principal que debe enviar el dato de
 pulsaciones (Listado XXXXXX).
\end_layout

\begin_layout Standard
\begin_inset Float listing
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset listings
lstparams "language=C,basicstyle={\footnotesize},tabsize=4"
inline false
status open

\begin_layout Plain Layout

if(INTCONbits.TMR0IE && INTCONbits.TMR0IF) {
\end_layout

\begin_layout Plain Layout

    if(conteo_timer0 >=152) { // 2 segundos aprox.
\end_layout

\begin_layout Plain Layout

        send_value = true;
\end_layout

\begin_layout Plain Layout

        conteo_timer0 = 0;
\end_layout

\begin_layout Plain Layout

    } else {
\end_layout

\begin_layout Plain Layout

        conteo_timer0 += 1; // Incrementar contador de desborde de timer0
\end_layout

\begin_layout Plain Layout

    }
\end_layout

\begin_layout Plain Layout

    INTCONbits.TMR0IF = 0; // Limpiamos bandera de desborde  
\end_layout

\begin_layout Plain Layout

}
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "lis:Manejo-del-desbordamiento"

\end_inset

Manejo del desbordamiento del 
\emph on
Timer 0
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
Si en el periodo entre envíos el pulsómetro no ha detectado ninguna pulsación
 válida, es decir, que esté entre 40 y 200
\begin_inset space ~
\end_inset

PPM, se envía un byte con valor 0 que el smartphone interpreta como nulo.
\end_layout

\begin_layout Section
Software
\begin_inset CommandInset label
LatexCommand label
name "sec:Software"

\end_inset


\end_layout

\begin_layout Standard
El 
\emph on
software
\emph default
 del pulsómetro se encarga de mostrar al usuario los datos de pulsaciones
 por minuto obtenidos por el 
\emph on
hardware
\emph default
.
 El programa está escrito en lenguaje Java para el sistema operativo Android.
\end_layout

\begin_layout Standard
El desarrollo se ha realizado con el IDE Android Studio y un smartphone
 Motorola Moto E.
 La aplicación se ha probado sobre Android 5.0, pero puede funcionar en cualquier
 dispositivo con Android 4.0 o superior.
 El programa se distribuye bajo los términos de la licencia 
\emph on
GNU GPL versión 3 o posterior
\emph default
 (el texto completo de la licencia se encuentra en el archivo 
\family typewriter
\size small
/src/LICENSE
\family default
\size default
) e incluye código desarrollado por el 
\emph on
Android Open Source Project
\emph default
 bajo licencia 
\emph on
Apache 2.0
\emph default
.
 Para mostrar el gráfico de histórico se utiliza la biblioteca 
\emph on
AndroidPlot
\emph default
 versión 0.6.1 tambien bajo licencia 
\emph on
Apache 2.0
\emph default
.
 Todo el código fuente puede encontrarse en el repositorio del proyecto
\begin_inset CommandInset citation
LatexCommand cite
key "bailon-ruiz_rafael1193/tfg-heart-rate-monitor_????"

\end_inset

.
\end_layout

\begin_layout Subsection
Descripción general
\end_layout

\begin_layout Standard
El lanzamiento de la aplicación se realiza pulsando sobre su icono, Figura
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Icono-de-la"

\end_inset

, en la lista de programas.
 Tras ello se iniciará y, si el Bluetooth no está activo, pedirá al usuario
 activarlo mostrando un mensaje como de la Figura 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Solicitud-de-activación"

\end_inset

.
 La respuesta negativa terminará el programa.
 
\end_layout

\begin_layout Standard
Una vez activado, se debe conectar al pulsómetro.
 Para ello hay que pulsar sobre el icono a la derecha de la 
\emph on
barra de acción
\emph default
, que mostrara una nueva vista, Figura 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Búsqueda-de-dispositivos"

\end_inset

, para seleccionar un dispositivo Bluetooth.
 Si ya se habia conectado antes, aparecerá en la sección de dispositivos
 vinculados; en caso contrario, puede encontrarlo pulsando en 
\family sans
BUSCAR DISPOSITIVOS
\family default
.
\end_layout

\begin_layout Standard
Si la conexión es satisfactoria la aplicación comenzará a recibir las pulsacione
s y las mostrará en la vista principal.
 En la parte superior se encuentra el dato instantáneo y en la parte inferior,
 el histórico (Figura 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Vista-principal-de"

\end_inset

).
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename /home/rafael/Documentos/4o Curso/8o Semestre/Trabajo Fin de Grado/img/pulsometro-icono.svg

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:Icono-de-la"

\end_inset

Icono de la aplicación Pulsómetro
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename ../img/app-activar_bluetooth.png
	lyxscale 25
	width 50text%

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:Solicitud-de-activación"

\end_inset

Solicitud de activación
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename ../img/app-buscando.png
	lyxscale 25
	width 50text%

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:Búsqueda-de-dispositivos"

\end_inset

Búsqueda de dispositivos
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
Bluetooth
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename ../img/app-midiendo.png
	lyxscale 25
	width 50text%

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:Vista-principal-de"

\end_inset

Vista principal de la aplicación
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Arquitectura
\end_layout

\begin_layout Standard
La interfaz gráfica está compuesta por dos clases que heredan de 
\family typewriter
\size small
Activity
\family default
\size default
:
\end_layout

\begin_layout Itemize
La clase 
\family typewriter
\size small
MainActivity
\family default
\size default
 (
\family typewriter
\size small
MainActivity.java
\family default
\size default
) representa la vista principal y contiene el 
\family typewriter
\size small
Fragment
\family default
\size default
 
\family typewriter
\size small
PulseMeterDisplayFragment
\family default
\size default
 (
\family typewriter
\size small
PulseMeterDisplayFragment\SpecialChar \-
.java
\family default
\size default
) que muestra las pulsaciones y la gráfica histórica.
 La gráfica es un objeto de la clase 
\family typewriter
\size small
XYPlot
\family default
\size default
.
\end_layout

\begin_layout Itemize
La clase 
\family typewriter
\size small
DeviceListActivity
\family default
\size default
 (
\family typewriter
\size small
DeviceListActivity.java
\family default
\size default
) respresenta la vista de selección de dispositivos.
\end_layout

\begin_layout Standard
La gestión de las conexiones Bluetooth se realiza a través de la clase 
\family typewriter
\size small
BluetoothService
\family default
\size default
 (
\family typewriter
\size small
BluetoothService.java
\family default
\size default
).
\end_layout

\begin_layout Subsubsection
Gestión de la comunicación
\end_layout

\begin_layout Standard
El primer paso para poder establecer comunicación Bluetooth es declarar
 los permisos para ello en el 
\emph on
manifiesto
\emph default
 de la aplicación (Listado 
\begin_inset CommandInset ref
LatexCommand ref
reference "lis:Declaración-de-permisos"

\end_inset

).
 Dichos permisos son 
\family typewriter
\size small
BLUETOOTH
\family default
\size default
 para poder conectar con dispositivos emparejados y 
\family typewriter
\size small
BLUETOOTH_ADMIN
\family default
\size default
 para descubrir nuevos dispositivos.
\end_layout

\begin_layout Standard
\begin_inset Float listing
wide false
sideways false
status open

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout
\begin_inset listings
lstparams "language=XML,basicstyle={\footnotesize},breaklines=true,tabsize=4"
inline false
status open

\begin_layout Plain Layout

<manifest .
 .
 .
 >
\end_layout

\begin_layout Plain Layout

	<uses-permission android:name="android.permission.BLUETOOTH" />
\end_layout

\begin_layout Plain Layout

	<uses-permission android:name="android.permission.BLUETOOTH_ADMIN" />
\end_layout

\begin_layout Plain Layout

	.
 .
 .
\end_layout

\begin_layout Plain Layout

</manifest>
\end_layout

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "lis:Declaración-de-permisos"

\end_inset

Declaración de permisos Bluetooth
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
Con los permisos declarados, establecer la comunicación con un dispositivo
 remoto consiste en los siguientes pasos
\begin_inset CommandInset citation
LatexCommand cite
key "android_open_source_project_bluetooth_????"

\end_inset

:
\end_layout

\begin_layout Enumerate
Obtener 
\family typewriter
\size small
BluetoothAdapter
\family default
\size default
, con 
\family typewriter
\size small
BluetoothAdapter.getDefaultAdapter()
\family default
\size default
.
 Una clase que representa el adapotador Bluetooth local
\begin_inset CommandInset citation
LatexCommand cite
key "android_open_source_project_bluetoothadapter_????"

\end_inset

.
\end_layout

\begin_layout Enumerate
Activar Bluetooth con el código del Listado 
\begin_inset CommandInset ref
LatexCommand ref
reference "lis:Activación-de-Bluetooth"

\end_inset

.
 Ejecutando este código se muestra el mensaje de la Figura 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Solicitud-de-activación"

\end_inset

.
\end_layout

\begin_layout Enumerate
Buscar dispositivos:
\end_layout

\begin_deeper
\begin_layout Itemize
Si ya están emparejados se obtienen con 
\family typewriter
\size small
mBluetoothAdapter.getBondedDevices()
\family default
\size default
.
\end_layout

\begin_layout Itemize
Si no están emparejados se llama a 
\family typewriter
\size small
mBluetoothAdapter.
\family default
\size default
startDiscovery(), que inicia el descubirmiento de manera asíncrona.
 Tras 12 segundos
\begin_inset CommandInset citation
LatexCommand cite
key "android_open_source_project_bluetoothadapter_????"

\end_inset

 notifica a la aplicación los dispositivos encontrado que se encuentren
 en modo descubrimiento.
 El módulo RN-42 están en este modo siempre que no esté conectado ya a otro
 dispositivo
\begin_inset CommandInset citation
LatexCommand cite
key "roving_networks_roving_2009"

\end_inset

.
\end_layout

\end_deeper
\begin_layout Enumerate
Establecer la conexión entre los dispositivos (Listado 
\begin_inset CommandInset ref
LatexCommand ref
reference "lis:Establecimiento-de-la"

\end_inset

):
\end_layout

\begin_deeper
\begin_layout Itemize
El módulo RN-42 actúa como servidor y el smartphone como cliente.
\end_layout

\begin_layout Itemize
Este proceso debe hacerse en otro hilo distinto al de la interfaz ya que
 la apertura del canal (
\emph on
Socket
\emph default
) bloquea la ejecución mientras se realiza.
 Si no se paralelizara, Android mostraría el mensaje 
\begin_inset Quotes fld
\end_inset

Esta aplicación no responde
\begin_inset Quotes frd
\end_inset

.
\end_layout

\begin_layout Itemize
El socket abierto utiliza el protocolo RFCOMM
\begin_inset CommandInset nomenclature
LatexCommand nomenclature
symbol "RFCOMM"
description "Radio Frequency Communications"

\end_inset

, que proporciona un flujo de datos serie virtual similar a RS-232 sobre
 Bluetooth
\begin_inset CommandInset citation
LatexCommand cite
key "bluetooth_sig_rfcomm_????"

\end_inset

.
\end_layout

\begin_layout Itemize
Cliente y servidor deben compartir el mismo UUID
\begin_inset CommandInset nomenclature
LatexCommand nomenclature
symbol "UUID"
description "Universally Unique IDentifier"

\end_inset

 para que estén en el mismo canal
\begin_inset CommandInset citation
LatexCommand cite
key "android_open_source_project_bluetoothadapter_????"

\end_inset

.
\end_layout

\end_deeper
\begin_layout Standard
\begin_inset Float listing
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset listings
lstparams "language=Java,basicstyle={\footnotesize},tabsize=4"
inline false
status open

\begin_layout Plain Layout

if (!mBluetoothAdapter.isEnabled()) {
\end_layout

\begin_layout Plain Layout

    Intent enableBtIntent = new Intent(BluetoothAdapter.ACTION_REQUEST_ENABLE);
\end_layout

\begin_layout Plain Layout

    startActivityForResult(enableBtIntent, REQUEST_ENABLE_BT);
\end_layout

\begin_layout Plain Layout

}
\end_layout

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "lis:Activación-de-Bluetooth"

\end_inset

Activación de Bluetooth
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float listing
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset listings
lstparams "language=Java,basicstyle={\footnotesize},tabsize=4"
inline false
status open

\begin_layout Plain Layout

private static final UUID MY_UUID = 
\end_layout

\begin_layout Plain Layout

        UUID.fromString("00001101-0000-1000-8000-00805F9B34FB");
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

private class AcceptThread extends Thread {
\end_layout

\begin_layout Plain Layout

    private final BluetoothServerSocket mmServerSocket;
\end_layout

\begin_layout Plain Layout

 
\end_layout

\begin_layout Plain Layout

    public AcceptThread() {
\end_layout

\begin_layout Plain Layout

        BluetoothServerSocket tmp = null;
\end_layout

\begin_layout Plain Layout

        try {
\end_layout

\begin_layout Plain Layout

            tmp = mBluetoothAdapter.listenUsingRfcommWithServiceRecord(
\end_layout

\begin_layout Plain Layout

                    NAME, MY_UUID);
\end_layout

\begin_layout Plain Layout

        } catch (IOException e) { }
\end_layout

\begin_layout Plain Layout

        mmServerSocket = tmp;
\end_layout

\begin_layout Plain Layout

    }
\end_layout

\begin_layout Plain Layout

 
\end_layout

\begin_layout Plain Layout

    public void run() {
\end_layout

\begin_layout Plain Layout

        BluetoothSocket socket = null;
\end_layout

\begin_layout Plain Layout

        while (true) {
\end_layout

\begin_layout Plain Layout

            try {
\end_layout

\begin_layout Plain Layout

                socket = mmServerSocket.accept();
\end_layout

\begin_layout Plain Layout

            } catch (IOException e) {
\end_layout

\begin_layout Plain Layout

                break;
\end_layout

\begin_layout Plain Layout

            }
\end_layout

\begin_layout Plain Layout

            if (socket != null) {
\end_layout

\begin_layout Plain Layout

                // La gestión de la conexión se realiza en otro hilo
\end_layout

\begin_layout Plain Layout

                manageConnectedSocket(socket);
\end_layout

\begin_layout Plain Layout

                mmServerSocket.close();
\end_layout

\begin_layout Plain Layout

                break;
\end_layout

\begin_layout Plain Layout

            }
\end_layout

\begin_layout Plain Layout

        }
\end_layout

\begin_layout Plain Layout

    }
\end_layout

\begin_layout Plain Layout

 
\end_layout

\begin_layout Plain Layout

    public void cancel() {
\end_layout

\begin_layout Plain Layout

        try {
\end_layout

\begin_layout Plain Layout

            mmServerSocket.close();
\end_layout

\begin_layout Plain Layout

        } catch (IOException e) { }
\end_layout

\begin_layout Plain Layout

    }
\end_layout

\begin_layout Plain Layout

}
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "lis:Establecimiento-de-la"

\end_inset

Establecimiento de la conexion
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float listing
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset listings
lstparams "language=Java,basicstyle={\footnotesize},breaklines=true,tabsize=4"
inline false
status open

\begin_layout Plain Layout

private class ConnectedThread extends Thread {
\end_layout

\begin_layout Plain Layout

    private final BluetoothSocket mmSocket;
\end_layout

\begin_layout Plain Layout

    private final InputStream mmInStream;
\end_layout

\begin_layout Plain Layout

    private final OutputStream mmOutStream;
\end_layout

\begin_layout Plain Layout

 
\end_layout

\begin_layout Plain Layout

    public ConnectedThread(BluetoothSocket socket) {
\end_layout

\begin_layout Plain Layout

        mmSocket = socket;
\end_layout

\begin_layout Plain Layout

        InputStream tmpIn = null;
\end_layout

\begin_layout Plain Layout

        OutputStream tmpOut = null;
\end_layout

\begin_layout Plain Layout

 
\end_layout

\begin_layout Plain Layout

        try {
\end_layout

\begin_layout Plain Layout

            tmpIn = socket.getInputStream();
\end_layout

\begin_layout Plain Layout

            tmpOut = socket.getOutputStream();
\end_layout

\begin_layout Plain Layout

        } catch (IOException e) { }
\end_layout

\begin_layout Plain Layout

 
\end_layout

\begin_layout Plain Layout

        mmInStream = tmpIn;
\end_layout

\begin_layout Plain Layout

        mmOutStream = tmpOut;
\end_layout

\begin_layout Plain Layout

    }
\end_layout

\begin_layout Plain Layout

 
\end_layout

\begin_layout Plain Layout

    public void run() {
\end_layout

\begin_layout Plain Layout

        byte[] buffer = new byte[1024];
\end_layout

\begin_layout Plain Layout

        int bytes;
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

        while (true) {
\end_layout

\begin_layout Plain Layout

            try {
\end_layout

\begin_layout Plain Layout

                bytes = mmInStream.read(buffer);
\end_layout

\begin_layout Plain Layout

                // Envía los datos obtenidos hacia el hilo principal
\end_layout

\begin_layout Plain Layout

                mHandler.obtainMessage(MESSAGE_READ, bytes, -1, buffer)
\end_layout

\begin_layout Plain Layout

                        .sendToTarget();
\end_layout

\begin_layout Plain Layout

            } catch (IOException e) {
\end_layout

\begin_layout Plain Layout

                break;
\end_layout

\begin_layout Plain Layout

            }
\end_layout

\begin_layout Plain Layout

        }
\end_layout

\begin_layout Plain Layout

    }
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

    public void write(byte[] bytes) {
\end_layout

\begin_layout Plain Layout

        try {
\end_layout

\begin_layout Plain Layout

            mmOutStream.write(bytes);
\end_layout

\begin_layout Plain Layout

        } catch (IOException e) { }
\end_layout

\begin_layout Plain Layout

    }
\end_layout

\begin_layout Plain Layout

 
\end_layout

\begin_layout Plain Layout

    public void cancel() {
\end_layout

\begin_layout Plain Layout

        try {
\end_layout

\begin_layout Plain Layout

            mmSocket.close();
\end_layout

\begin_layout Plain Layout

        } catch (IOException e) { }
\end_layout

\begin_layout Plain Layout

    }
\end_layout

\begin_layout Plain Layout

}
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "lis:Gestión-de-la"

\end_inset

Gestión de la conexión Bluetooth
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
La recepción de datos, Listado 
\begin_inset CommandInset ref
LatexCommand ref
reference "lis:Gestión-de-la"

\end_inset

, también debe hacerse en otro hilo ya que el método 
\family typewriter
\size small
read(byte[])
\family default
\size default
 bloquea la ejecución hasta que recibe algo para leer.
 Una vez cargado el buffer con datos, estos se envían al hilo principal
 a través de un objeto de la clase 
\family typewriter
\size small
Handler
\family default
\size default
.
 Esta clase, incluida en la API
\begin_inset CommandInset nomenclature
LatexCommand nomenclature
symbol "API"
description "Application Programming Interface"

\end_inset

 de Android, permite enviar y recibir mensajes e información entre hilos
 de forma segura.
\end_layout

\begin_layout Standard
El dato de pulsaciones por minuto que se envía desde el pulsómetro viene
 codificado como un byte cuyo valor está entre 40 y 200.
 Debido a que el lenguaje de programación Java no permite trabajar con variables
 enteras sin signo, los valores superiores a 128 son interpretados como
 negativos en complemento a dos.
 Para tratar este problema, el Listado 
\begin_inset CommandInset ref
LatexCommand ref
reference "lis:Ajuste-para-trabajar"

\end_inset

 contiene el código para solucionarlo, que pasa por trabajar con enteros
 de tamaño superior.
\end_layout

\begin_layout Standard
\begin_inset Float listing
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset listings
lstparams "language=Java,basicstyle={\footnotesize},breaklines=true,tabsize=4"
inline false
status open

\begin_layout Plain Layout

byte[] readBuf = .
 .
 .;
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

Integer firstValue = (int)readBuf[0];
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

if(readBuf[0] < 0) {
\end_layout

\begin_layout Plain Layout

    firstValue= (int) readBuf[0] & 0xff;
\end_layout

\begin_layout Plain Layout

}
\end_layout

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "lis:Ajuste-para-trabajar"

\end_inset

Ajuste para trabajar con enteros sin signo en Java
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Subsubsection
Representación de la información
\end_layout

\begin_layout Standard
Los datos se representan de forma numérica, pulsaciones por minuto actuales,
 e histórica, gráfica con los últimos datos recibidos.
\end_layout

\begin_layout Standard
Debido a las limitaciones de la pulsimetría, comentadas en el apartado 
\begin_inset Note Note
status open

\begin_layout Plain Layout
referencia a capitulo donde se explican las ventajas e inconvenientes de
 la pulsoximetría.
\end_layout

\end_inset

, hay instantes en los que no se detectan pulsos o hay variaciones en el
 leído.
 Para reducir la variabilidad, el dato que se muestra consiste en la media
 de los últimos 5 valores válidos.
 De esta manera la gráfica es precisa, porque no aparecen requiebros, sin
 perder la exactitud ya que las pulsaciones de un paciente varían mas lentamente.
\end_layout

\begin_layout Standard
Para dibujar sobre la gráfica tan solo hay que crear un objeto de la clase
 
\family typewriter
\size small
SimpleXYSeries
\family default
\size default
, asignarlo al objeto de la clase 
\family typewriter
\size small
XYPlot
\family default
\size default
 e ir añadiendo datos nuevo a la vez que se retiran los antiguos.
\end_layout

\begin_layout Chapter
Resultados
\begin_inset CommandInset label
LatexCommand label
name "chap:Resultados"

\end_inset


\end_layout

\begin_layout Section
Caracterización de los filtros
\end_layout

\begin_layout Section
Pruebas de validación
\begin_inset CommandInset label
LatexCommand label
name "sec:Pruebas-de-validación"

\end_inset


\end_layout

\begin_layout Standard
Se ha llevado a cabo pruebas de validación para comprobar la fidelidad de
 los datos recogidos por el dispositivo diseñado.
\end_layout

\begin_layout Standard
Los test han consistido en la toma de pulsaciones en reposo y la evolución
 dinámica de la frecuencia cardíaca tras ejercicio moderado.
 El sujeto de prueba ha sido un varón atleta veterano de 54 años.
 La validación de los datos se ha realizado capturando simultáneamente y
 de forma periódica los datos del pulsómetro basado en PPG y un cardiofrecuencím
etro comercial basado en ECG (Figura 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Cardiofrecuencímetro-Cardio-ONrh"

\end_inset

).
 El cardiofrecuencímetro está compuesto por una banda que se coloca sobre
 el pecho, a la altura del corazón, y que envía por radiofrecuencia las
 pulsaciones detectadas a un receptor con forma de reloj que se coloca en
 la muñeca.
\end_layout

\begin_layout Subsection
Prueba estática
\begin_inset CommandInset label
LatexCommand label
name "sub:Prueba-estática"

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float table
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Tabular
<lyxtabular version="3" rows="10" columns="3">
<features rotate="0" tabularvalignment="middle">
<column alignment="decimal" decimal_point="." valignment="top" width="0pt">
<column alignment="decimal" decimal_point="." valignment="top" width="0pt">
<column alignment="decimal" decimal_point="." valignment="top" width="0pt">
<row>
<cell alignment="decimal" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Tiempo [s]
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Pulsómetro [PPM]
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" topline="true" bottomline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Cardiofrecuencímetro[PPM]
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="decimal" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
67
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" topline="true" bottomline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
68
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
15
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
66
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" bottomline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
67
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
30
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
72
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" bottomline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
66
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
45
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
70
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" bottomline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
71
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
60
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
67
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" bottomline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
71
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
75
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
71
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" bottomline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
68
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
90
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
67
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" bottomline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
71
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
120
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
79
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" bottomline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
68
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
135
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
70
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" bottomline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
70
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "tab:Datos-obtenidos-en"

\end_inset

Pulsaciones del sujeto durante la prueba estática
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
La prueba estática se ha realizado sobre el sujeto en estado de reposo.
 Se ha realizado un estudio estadístico a partir de los datos de la Tabla
 
\begin_inset CommandInset ref
LatexCommand ref
reference "tab:Datos-obtenidos-en"

\end_inset

.
\end_layout

\begin_layout Standard
\begin_inset Float table
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Tabular
<lyxtabular version="3" rows="7" columns="3">
<features rotate="0" tabularvalignment="middle">
<column alignment="left" valignment="top" width="0pt">
<column alignment="decimal" decimal_point="." valignment="top" width="0pt">
<column alignment="decimal" decimal_point="." valignment="top" width="0pt">
<row>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Pulsómetro
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Cardiofrecuencímetro
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Promedio pulsaciones [PPM]
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
70
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
69
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Desviación estandar
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
4,01
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1,90
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
g
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
8
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
8
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
n
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
9
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
9
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
t student (0,9950)
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
3,355
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
3,355
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Error absoluto
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\pm$
\end_inset

4,49
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\pm$
\end_inset

2,12
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "tab:Parámetros-estadísticos-de"

\end_inset

Parámetros estadísticos de la prueba estática
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
El promedio de pulsaciones obtenido con el pulsómetro diseñado es similar
 al del pulsómetro comercial.
 Sin embargo, como aparece en la Tabla 
\begin_inset CommandInset ref
LatexCommand ref
reference "tab:Parámetros-estadísticos-de"

\end_inset

, la variabilidad de las muestras es mayor.
 
\end_layout

\begin_layout Standard
Suponiendo que las muestras siguen una distribución normal, se puede aplicar
 la Ecuación 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:error-t-student"

\end_inset


\begin_inset CommandInset citation
LatexCommand cite
key "ramos_abalos_estadistica_2010"

\end_inset

 haciendo uso de la distribución t de student para conocer el error absoluto
 del pulsómetro diseñado.
 
\begin_inset Formula $n$
\end_inset

 es el número de muestras y
\begin_inset Formula $g$
\end_inset

 es el número de grados de libertad, 
\begin_inset Formula $n-1$
\end_inset

.
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
e=t\cdot\frac{S}{\sqrt{n}}\label{eq:error-t-student}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
El intervalo de error de las muestras del pulsómetro PPG es 
\begin_inset Formula $\pm4,76$
\end_inset

 con una confianza del 99,5%, mientras que el del pulsómetro ECG es 
\begin_inset Formula $\pm2,25$
\end_inset

 también con una confianza del 99,5%.
 El dato 
\end_layout

\begin_layout Standard
Cabe destacar que en el instante 105
\begin_inset space ~
\end_inset

s no se puedo obtener el dato del pulsómetro PPG.
 La razón es que la prueba se realizó con el prototipo del instrumento,
 cuyo sensor óptico no se fija al dedo del paciente, si no que lo posa sobre
 el dispositivo.
 En el momento de la medida no se encontraba bien colocado y se decidió
 esperar al siguiente instante.
\end_layout

\begin_layout Subsection
Prueba dinámica
\begin_inset CommandInset label
LatexCommand label
name "sub:Prueba-dinámica"

\end_inset


\end_layout

\begin_layout Standard
La prueba dinámica consiste en medir las pulsaciones del sujeto durante
 el periodo de recuperación tras ejercicio intenso: correr subiendo escaleras
 8 pisos y un tramo recto de 100
\begin_inset space ~
\end_inset

m.
\end_layout

\begin_layout Standard
\begin_inset Float table
wide false
sideways false
status open

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout
\align center
\begin_inset Tabular
<lyxtabular version="3" rows="15" columns="3">
<features rotate="0" tabularvalignment="middle">
<column alignment="decimal" decimal_point="." valignment="top" width="0pt">
<column alignment="decimal" decimal_point="." valignment="top" width="0pt">
<column alignment="decimal" decimal_point="." valignment="top" width="0pt">
<row>
<cell alignment="decimal" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Tiempo [s]
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Pulsómetro [PPM]
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Cardiofrecuencímetro [PPM]
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="decimal" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
15
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
134
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
136
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
30
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
126
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
130
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
45
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
119
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
122
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
60
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
119
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
118
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
75
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
113
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
113
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
90
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
112
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
108
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
105
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
104
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
105
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
135
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
106
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
105
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
150
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
102
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
101
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
165
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
99
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
100
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
180
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
95
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
99
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
195
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
99
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
97
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
210
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
93
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
94
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
225
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
94
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
93
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "tab:Pulsaciones-del-sujeto"

\end_inset

Pulsaciones del sujeto durante el periodo de recuperación
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename ../img/pulsaciones-recuperacion.svg
	lyxscale 2
	width 100text%

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:Pulsaciones-del-sujeto"

\end_inset

Representación de las pulsaciones del sujeto durante el periodo de recuperación
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
En la Tabla 
\begin_inset CommandInset ref
LatexCommand ref
reference "tab:Pulsaciones-del-sujeto"

\end_inset

 están los datos del experimento, que son representados en la Figura 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Pulsaciones-del-sujeto"

\end_inset

.
 Con unos coeficientes 
\begin_inset Formula $R^{2}=0,9374$
\end_inset

 para el pulsómetro y 
\begin_inset Formula $R^{2}=0,9339$
\end_inset

 para el cardiofrecuencímetro se puede afirmar que la evolución de las pulsacion
es tras el ejercicio físico sigue una ley exponencial decreciente cuyo límite
 tiende a las pulsaciones en el estado de reposo.
\end_layout

\begin_layout Standard
\begin_inset Float table
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Tabular
<lyxtabular version="3" rows="15" columns="3">
<features rotate="0" tabularvalignment="middle">
<column alignment="decimal" decimal_point="." valignment="top" width="0pt">
<column alignment="decimal" decimal_point="." valignment="top" width="0pt">
<column alignment="decimal" decimal_point="." valignment="top" width="0pt">
<row>
<cell alignment="decimal" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Tiempo [s]
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Pulsómetro [PPM]
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Cardiofrecuencímetro [PPM]
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="decimal" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
15
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
64
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
67
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
30
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
56
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
61
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
45
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
49
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
53
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
60
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
49
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
49
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
75
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
43
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
44
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
90
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
42
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
39
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
105
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
34
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
36
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
135
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
36
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
36
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
150
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
32
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
32
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
165
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
29
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
31
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
180
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
25
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
30
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
195
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
29
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
28
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
210
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
23
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
25
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
225
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
24
\end_layout

\end_inset
</cell>
<cell alignment="decimal" valignment="top" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
24
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "tab:Incremento-de-pulsaciones"

\end_inset

Incremento de pulsaciones del sujeto respecto a las de reposo durante el
 periodo de recuperación
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
Si se toman los datos respecto a las pulsaciones en reposo de la Tabla 
\begin_inset CommandInset ref
LatexCommand ref
reference "tab:Parámetros-estadísticos-de"

\end_inset

 (Tabla 
\begin_inset CommandInset ref
LatexCommand ref
reference "tab:Incremento-de-pulsaciones"

\end_inset

) se puede estudiar la evolución desvínculandola de las diferencias entre
 instrumentos que se observaron en el apartado 
\begin_inset CommandInset ref
LatexCommand ref
reference "sub:Prueba-estática"

\end_inset

.
 De nuevo se han perdido instantes de tiempo, 0 y 120
\begin_inset space ~
\end_inset

segundos, debido a la construcción física del sensor óptico.
\end_layout

\begin_layout Standard
La gráfica de la Figura 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Incremento-de-las"

\end_inset

 muestra como los ajustes de mínimos cuadrados de ambos instrumentos tienen
 la misma pendiente, con lo se puede afirmar que responden de manera similar
 antes cambios en la frecuencía cardíaca del sujeto.
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename /home/rafael/Documentos/4o Curso/8o Semestre/Trabajo Fin de Grado/img/desviacion-pulsaciones.svg
	lyxscale 2
	width 100text%

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:Incremento-de-las"

\end_inset

Representación del incremento de las pulsaciones del sujeto respecto al
 reposo
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
Finalmente, la correlación entre los datos obtenidos con el pulsómetro y
 el cardiofrecuencímetro, representada en la Figura 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Pulsómetro-frente-a"

\end_inset

, es 1 con coeficiente de determinación 
\begin_inset Formula $R^{2}$
\end_inset

 prácticamente 1.
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename ../img/pulsometro-vs-cardiofrecuencimetro.svg
	lyxscale 2

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:Pulsómetro-frente-a"

\end_inset

Representación de la correlación entre datos obtenidos del pulsómetro y
 del cardiofrecuencímetro
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Chapter
Conclusiones y trabajos futuros
\end_layout

\begin_layout Section
Conclusiones
\end_layout

\begin_layout Standard
Este Trabajo Fin de Grado ha presentado de manera detallada el diseño de
 un dispositivo pulsimétrico con conexión inalábrica a un dispositivo móvil
 para visualización de los datos.
 Se ha realizado la descripción de los fundamentos teóricos de la técnica
 y un estudio del estado del arte en la materia.
 Dicho estudio ha revelado el auge de este tipo de instrumentos aplicados
 en los campos de la salud y el deporte.
\end_layout

\begin_layout Standard
Se ha comprobado el correcto funcionamiento del pulsómetro realizando tests
 en comparación con otro dispositivo comercial.
 Estas pruebas también han servido para descubrir las limitaciones del producto:
 no se pueden obtener muestras fiables cuando el sujeto se encuentra en
 movimiento.
 Esto limita las aplicaciones deportivas, pero siguen siendo válidas las
 sanitarias tanto en centros sanitarios como en el hogar.
\end_layout

\begin_layout Standard
La comunicación inalámbrica con el smartphone es un elemento novedoso que
 sigue la guía del desarrollo tecnológico que se dirige hacia el 
\emph on
Internet de las cosas
\emph default
 y los 
\emph on
dispositivos vestibles
\emph default
.
 La puesta en marcha y el uso del aparato es muy sencilla: lanzar la aplicación,
 pulsar conectar y comenzar a medir.
 Cualquier persona puede utilizarlo con facilidad, desde niños hasta personas
 ancianas.
\end_layout

\begin_layout Standard
El uso de la pulsimetría sobre pacientes no afecta de ningun modo a su salud
 pues su fundamento es óptico: no hay procedimientos invasivos ni conexiones
 eléctricas al cuerpo.
 Esto último es especialmente importante para los usuarios de marcapasos,
 que son muy sensibles a perturbaciones eléctricas y magnéticas.
\end_layout

\begin_layout Section
Trabajos futuros
\end_layout

\begin_layout Standard
El diseño presentado en este Trabajo Fin de Grado es una base tecnológica
 que puede ser aprovechada para ser aplicada en dispositivos comerciales
 solución a problemas de la sociedad.
\end_layout

\begin_layout Standard
La línea principal del proyecto para el futuro es pasar del montaje experimental
 al producto final.
 Ha quedado pendiente producir la placa de circuito impreso que si ha sido
 diseñada.
 Diseñar y construir un mejor sistema de fijación del sensor al dedo es
 importante para reducir los artefactos en la señal recogida por el instrumento.
\end_layout

\begin_layout Standard
La aplicación móvil puede ampliarse con más funcionalidades como permitir
 la configuración de elementos de la interfaz.
 También podría plantearse portarla a otros sistemas operativos como iOS
 o Windows Phone.
\end_layout

\begin_layout Standard
\begin_inset Note Note
status open

\begin_layout Plain Layout
\begin_inset CommandInset bibtex
LatexCommand bibtex
bibfiles "bibliography"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
printbibliography
\end_layout

\end_inset


\end_layout

\end_body
\end_document
